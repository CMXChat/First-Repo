<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

<title>CMX Contributor Fit, quick assessment for community contributors</title>
<meta name="description" content="Fast interactive assessment for creators and startup friendly contributors, measures initiative, ownership, reliability, and decision style. No login, private in your browser.">
<link rel="canonical" href="https://cmx.example/contributor-fit">
<meta property="og:title" content="CMX Contributor Fit, quick assessment">
<meta property="og:description" content="Find your best way to help CMX, a friendly, private assessment scored in your browser.">
<meta property="og:type" content="website">

<style>
  :root{
    --ink:#0f172a; --muted:#64748b; --bg:#f6f8fd; --card:#ffffff; --line:#e5e7eb;
    --brand:#2563eb; --brand2:#60a5fa; --ok:#16a34a; --warn:#f59e0b; --bad:#dc2626;
    --radius:16px;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);
    font:16px/1.55 Inter, ui-sans-serif, system-ui, Segoe UI, Roboto, Helvetica, Arial}
  body{overflow-x:hidden}
  a{color:var(--brand);text-decoration:none}
  .wrap{max-width:860px;margin:0 auto;padding:14px}
  header{display:flex;gap:8px;flex-wrap:wrap;justify-content:space-between;align-items:center;padding:6px 2px}
  .brand{font-weight:700;letter-spacing:.2px}
  .chip{border:1px solid var(--line);background:#fff;color:#111827;padding:8px 12px;border-radius:999px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);padding:16px;box-shadow:0 1px 0 rgba(17,24,39,.03)}
  .muted{color:var(--muted)}
  .progress{height:10px;background:#eef2ff;border-radius:999px;border:1px solid var(--line);overflow:hidden}
  .bar{height:100%;width:0;background:linear-gradient(90deg,var(--brand),var(--brand2));transition:width .25s ease}
  .stage{display:none}
  .stage.active{display:block}
  .qcard{min-height:260px;display:flex;flex-direction:column;gap:12px}
  .qnum{font-size:12px;color:#64748b}
  .qtext{font-size:18px;line-height:1.35}
  .row{display:grid;gap:10px;grid-template-columns:minmax(0,1fr)}
  .triad{display:grid;gap:10px}
  .opt{border:1px solid var(--line);background:#fff;border-radius:14px;padding:12px;cursor:pointer;text-align:left}
  .opt.active{border-color:var(--brand);box-shadow:0 0 0 3px rgba(37,99,235,.12)}
  .optline{display:flex;gap:8px;align-items:center}
  .badge{font-size:12px;border:1px solid var(--line);padding:4px 8px;border-radius:999px;background:#f8fafc}
  .badge.most{border-color:#bbf7d0;background:#ecfdf5;color:#166534;display:none}
  .badge.least{border-color:#fed7aa;background:#fff7ed;color:#7c2d12;display:none}
  .nav{display:flex;gap:8px;justify-content:space-between;margin-top:6px}
  .btn{border:1px solid var(--line);background:#fff;padding:12px 14px;border-radius:12px;cursor:pointer;max-width:100%}
  .btn[disabled]{opacity:.6;cursor:not-allowed}
  .btn.primary{background:#2563eb;color:#fff;border-color:transparent}
  .pill{padding:8px 10px;border:1px solid var(--line);border-radius:999px;background:#fff;display:inline-flex;gap:8px;align-items:center}
  select,.mono,.scorebar{max-width:100%}
  .mono{
    font-family:ui-monospace,Menlo,monospace;
    font-size:clamp(13px,3.5vw,14px);
    background:#fbfdff;border:1px dashed var(--line);border-radius:12px;color:#0f172a;padding:10px;
    white-space:pre-wrap; overflow-wrap:anywhere; word-break:break-word;
  }
  .scorebar{height:10px;background:#eef2ff;border:1px solid var(--line);border-radius:999px;overflow:hidden}
  .scorebar>span{display:block;height:100%;background:linear-gradient(90deg,var(--brand),var(--brand2))}
  .kbad{display:inline-block;font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:#f8fafc}
  .kbad.ok{border-color:#bbf7d0;color:#166534;background:#ecfdf5}
  .kbad.warn{border-color:#fed7aa;color:#7c2d12;background:#fff7ed}
  .kbad.bad{border-color:#fecaca;color:#7f1d1d;background:#fff1f2}
  #radar{display:block;width:100% !important;height:auto !important;max-width:100%}
  canvas{max-width:100%;height:auto}
  .slide{animation:slide .22s ease}
  @keyframes slide{from{transform:translateX(20px);opacity:.0}to{transform:translateX(0);opacity:1}}
  footer{margin:20px 6px;color:#94a3b8;font-size:12px}
  .mobileOnly{display:inline-block}
  @media (min-width:720px){ .mobileOnly{display:none} }
  @media (min-width:760px){ .qtext{font-size:20px} .opt{padding:14px} }
  @media print{ header,.nav,.btn,footer{display:none!important} body{background:#fff} .card{border:0;box-shadow:none} }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">CMX Contributor Fit</div>
    <!-- timer hidden from UI on purpose -->
  </header>

  <div class="card">
    <div class="progress" aria-label="Progress"><div id="bar" class="bar"></div></div>
    <div id="pnote" class="muted" style="margin-top:6px">0% complete</div>
    <p class="muted" style="margin-top:8px">Takes about 4 to 5 minutes. No login. Your results stay on your device.</p>
  </div>

  <!-- TRIADS (short: 3) -->
  <section id="stageTriad" class="stage active">
    <div class="card qcard slide" id="triadCard">
      <div>
        <div class="qnum" id="tNum">Card 1 of 3</div>
        <div class="qtext">Pick the one that is MOST like you, and the one that is LEAST like you.</div>
      </div>
      <div id="triadBox" class="triad"></div>
      <div class="nav">
        <button type="button" id="tBack" class="btn">Back</button>
        <button type="button" id="tNext" class="btn primary" disabled>Next</button>
      </div>
    </div>
  </section>

  <!-- SJT (short: 1) -->
  <section id="stageSJT" class="stage">
    <div class="card qcard slide" id="sjtCard">
      <div>
        <div class="qnum" id="sNum">Scenario 1 of 1</div>
        <div class="qtext" id="sText">...</div>
      </div>
      <div id="sOpts" class="row"></div>
      <div class="nav">
        <button type="button" id="sBack" class="btn">Back</button>
        <button type="button" id="sNext" class="btn primary" disabled>Next</button>
      </div>
    </div>
  </section>

  <!-- SLIDER -->
  <section id="stageSlider" class="stage">
    <div class="card qcard slide">
      <div>
        <div class="qnum">Balance 1 of 1</div>
        <div class="qtext">Slide to show your usual balance. No right answer.</div>
      </div>
      <div class="row" style="padding:6px 4px">
        <div style="display:flex;justify-content:space-between;font-size:13px;color:#64748b;margin-bottom:6px">
          <span>Shipping fast</span><span>Polishing details</span>
        </div>
        <input type="range" id="balance" min="0" max="100" value="50" style="width:100%">
        <div class="muted" id="balNote" style="font-size:13px">Centered</div>
      </div>
      <div class="nav">
        <button type="button" id="bBack" class="btn">Back</button>
        <button type="button" id="bNext" class="btn primary">Next</button>
      </div>
    </div>
  </section>

  <!-- PLAN (optional) -->
  <section id="stagePlan" class="stage">
    <div class="card slide">
      <h3 style="margin:0 0 8px">Optional, quick plan</h3>
      <label class="pill"><input id="optTrial" type="checkbox"> I am open to a short trial</label>

      <div class="row" style="margin-top:12px">
        <label>Pick a small time block you can give most weeks</label>
        <div class="row">
          <label class="pill"><input type="radio" name="time" value="30m weekly sync"> 30 min weekly sync</label>
          <label class="pill"><input type="radio" name="time" value="60m build block"> 1 hour build block</label>
          <label class="pill"><input type="radio" name="time" value="async only"> Async only</label>
        </div>
      </div>

      <div class="row">
        <label>Pick one micro task</label>
        <select id="taskPick" class="btn">
          <option value="">Select a task</option>
          <option>Discord, welcome and ticket triage</option>
          <option>Community, draft ten room prompts</option>
          <option>Growth, qualify five potential clients</option>
          <option>SEO, draft meta for five pages</option>
          <option>Content, outline one blog with H2 H3</option>
          <option>Web, QA the rooms directory</option>
        </select>
      </div>

      <div class="row">
        <label>Your first 30 minutes, what will you do? <span class="muted">(optional)</span></label>
        <textarea id="planText" rows="4" class="mono" placeholder="Example: Post status in #ops, assign Owner A to links, run a quick link check, post a five item list."></textarea>
        <div class="muted" id="planHint" style="font-size:13px">Tip, concrete steps, owners, time, and a simple check get a better score.</div>
      </div>

      <div class="nav">
        <button type="button" id="pBack" class="btn">Back</button>
        <button type="button" id="seeResults" class="btn primary">See results</button>
      </div>
    </div>
  </section>

  <!-- RESULTS -->
  <section id="stageR" class="stage">
    <div class="card">
      <h2 style="margin:0 0 8px">Your results</h2>
      <p><strong>Contributor Fit, <span id="fitScore">0</span>/100</strong>
        <span id="collabBadge" class="kbad" style="margin-left:8px">Collaboration health</span>
        <span id="confBadge" class="kbad" style="margin-left:8px; display:none">Confidence</span>
        <span id="timeBadge" class="kbad" style="margin-left:8px; display:none">Time</span>
      </p>
      <p id="fitTier" class="muted"></p>

      <div id="scoreBox" class="row"></div>
      <canvas id="radar" width="560" height="360" style="margin-top:10px"></canvas>

      <div class="row"><h3 style="margin:10px 0 0">Top strengths</h3><p id="topTwo"></p></div>
      <div class="row"><h3 style="margin:10px 0 0">Role suggestions</h3><p id="roles"></p></div>
      <div class="row"><h3 style="margin:10px 0 0">Suggested first task</h3><p id="firstTask"></p></div>
      <div class="row"><h3 style="margin:10px 0 0">Engagement style</h3><p id="engStyle" class="muted"></p></div>

      <div class="row"><h3 style="margin:10px 0 0">Copyable summary</h3><pre id="summary" class="mono"></pre></div>

      <div class="row">
        <button type="button" id="copyBtn" class="btn">Copy summary</button>
        <button type="button" id="pngBtn" class="btn mobileOnly">Download PNG</button>
        <button type="button" id="printBtn" class="btn">Print</button>
        <button type="button" id="againBtn" class="btn">Retake</button>
      </div>
    </div>
  </section>

  <footer>Privacy, answers are scored in your browser. PNG download is created locally on your device.</footer>
</div>

<script>
/* ===== Soft retake tracking (no raw count shown) ===== */
const ATTEMPT_KEY='cmx_cf_attempts_v2';
let attempts=[]; try{ attempts=JSON.parse(localStorage.getItem(ATTEMPT_KEY)||'[]'); }catch{}
attempts.push(Date.now()); try{ localStorage.setItem(ATTEMPT_KEY, JSON.stringify(attempts)); }catch{}
function recentAttempts(hours=24){ const cutoff=Date.now()-hours*3600*1000; return attempts.filter(ts=>ts>=cutoff).length; }

/* ===== Hidden timer (target under 5 minutes) ===== */
const TOTAL_SECONDS = 5*60; // 5:00 cap
let timerStart = Date.now(), timerExpired=false;
function timeUsedSecs(){ return Math.floor((Date.now()-timerStart)/1000); }

/* ===== Data (short form) ===== */
const START = Date.now();
const TRAITS = [
  {k:'IN', name:'Initiative'},
  {k:'OW', name:'Ownership'},
  {k:'RE', name:'Reliability'},
  {k:'DE', name:'Decision style'}
];
// 3 quick triads
const TRIADS = [
  {id:'T1', items:[
    {id:'T1A', text:'I like turning messy ideas into simple checklists.', trait:'OW', pol:+1},
    {id:'T1B', text:'If a plan stalls, I try a quick workaround.', trait:'IN', pol:+1},
    {id:'T1C', text:'I prefer to wait until everyone has weighed in.', trait:'DE', pol:-1}]},
  {id:'T2', items:[
    {id:'T2A', text:'I am the friend who books the table and gets people there on time.', trait:'RE', pol:+1},
    {id:'T2B', text:'I will start, then figure the details while moving.', trait:'IN', pol:+1},
    {id:'T2C', text:'I collect opinions before I touch anything.', trait:'DE', pol:-1}]},
  {id:'T3', items:[
    {id:'T3A', text:'I keep short notes so others can jump in if I am away.', trait:'RE', pol:+1},
    {id:'T3B', text:'I ask two clarifying questions before I decide.', trait:'DE', pol:+1},
    {id:'T3C', text:'I enjoy welcoming newcomers in a server.', trait:'OW', pol:+1}]}
];
// 1 scenario
const SJT = [
  { id:'S1', stem:'You find that a new landing page drops signups by half',
    options:[{k:'A',t:'Run a quick rollback and post a two line status, create a short follow up list.',s:3},
             {k:'B',t:'Wait for a developer to check the code.',s:0},
             {k:'C',t:'Start a broad discussion about design quality.',s:0},
             {k:'D',t:'Vote for the loudest view and move on.',s:1}]}
];

/* ===== State ===== */
let tIndex=0, sIndex=0, sliderVal=50;
const triadPicks={}, sjtPicks={};
const plan={opt:false,time:'',task:'',text:''};
const triadTimes=[], sjtTimes=[], pairGaps=[], mostPositions=[], leastPositions=[];
let screenStart = Date.now(), firstTapTime = 0, sliderTouched=false, sjtPickLetters=[];
let debounceNext=false;

/* ===== Helpers ===== */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
function clamp(n,a,b){return Math.max(a,Math.min(b,n))}
function slideIn(el){el.classList.remove('slide');void el.offsetWidth;el.classList.add('slide');}
function setProgress(done,total){const pct=Math.round(done/total*100);$('#bar').style.width=pct+'%';$('#pnote').textContent=pct+'% complete';}
function progressTotal(){return TRIADS.length + SJT.length + 1}
function progressDone(){let d=0;TRIADS.forEach(t=>{if(triadPicks[t.id]?.most&&triadPicks[t.id]?.least)d++});d+=Object.keys(sjtPicks).length;d+=1;return d}
function goTop(){window.scrollTo({top:0,behavior:'smooth'})}

/* ===== Triads (short) ===== */
function renderTriad(){
  const tri=TRIADS[tIndex]; screenStart=Date.now(); firstTapTime=0;
  slideIn($('#triadCard'));
  $('#tNum').textContent=`Card ${tIndex+1} of ${TRIADS.length}`;
  $('#tBack').disabled=(tIndex===0);
  const st=triadPicks[tri.id]||{most:null,least:null};
  $('#tNext').disabled=!(st.most && st.least);

  const box=$('#triadBox'); box.innerHTML='';
  tri.items.forEach((opt,idx)=>{
    const row=document.createElement('button');
    row.type='button'; row.className='opt'; row.innerHTML=`<div class="optline"><span class="badge most">MOST</span><span class="badge least">LEAST</span><span>${opt.text}</span></div>`;
    if(st.most===opt.id){ row.querySelector('.most').style.display='inline-block'; row.classList.add('active'); }
    if(st.least===opt.id){ row.querySelector('.least').style.display='inline-block'; row.classList.add('active'); }
    row.onclick=()=>{
      if(!firstTapTime) firstTapTime = Date.now();
      const curr=triadPicks[tri.id]||{most:null,least:null};
      if(!curr.most){ curr.most=opt.id; mostPositions[tIndex]=idx; }
      else if(!curr.least && curr.most!==opt.id){ curr.least=opt.id; leastPositions[tIndex]=idx; pairGaps[tIndex] = Date.now()-firstTapTime; }
      else if(curr.most===opt.id){ curr.most=null; mostPositions[tIndex]=undefined; }
      else if(curr.least===opt.id){ curr.least=null; leastPositions[tIndex]=undefined; }
      else { curr.least=opt.id; leastPositions[tIndex]=idx; pairGaps[tIndex] = Date.now()-firstTapTime; }
      triadPicks[tri.id]=curr; $('#tNext').disabled=!(curr.most && curr.least); renderTriad();
    };
    box.appendChild(row);
  });

  $('#tBack').onclick=()=>{ if(tIndex>0){ triadTimes[tIndex]=Date.now()-screenStart; tIndex--; renderTriad(); setProgress(progressDone(),progressTotal()); goTop(); } };
  $('#tNext').onclick=()=>{ if(debounceNext) return; debounceNext=true; setTimeout(()=>debounceNext=false,180);
    if(!(triadPicks[tri.id]?.most&&triadPicks[tri.id]?.least)) return;
    triadTimes[tIndex]=Date.now()-screenStart;
    if(tIndex<TRIADS.length-1){ tIndex++; renderTriad(); } else { showStage('SJT'); renderSJT(); }
    setProgress(progressDone(),progressTotal()); goTop();
  };
  setProgress(progressDone(),progressTotal());
}

/* ===== SJT (1) ===== */
function renderSJT(){
  const s=SJT[sIndex]; screenStart=Date.now();
  $('#sNum').textContent=`Scenario ${sIndex+1} of ${SJT.length}`;
  $('#sText').textContent=s.stem;
  $('#sBack').disabled=(sIndex===0);
  $('#sNext').disabled=!sjtPicks[s.id];

  const box=$('#sOpts'); box.innerHTML='';
  s.options.forEach(o=>{
    const b=document.createElement('button'); b.type='button'; b.className='opt'; b.textContent=o.t;
    if(sjtPicks[s.id]===o.k) b.classList.add('active');
    b.onclick=()=>{ sjtPicks[s.id]=o.k; sjtPickLetters[sIndex]=o.k; $('#sNext').disabled=false; renderSJT(); };
    box.appendChild(b);
  });

  $('#sBack').onclick=()=>{ sjtTimes[sIndex]=Date.now()-screenStart; showStage('Triad'); };
  $('#sNext').onclick=()=>{ if(debounceNext) return; debounceNext=true; setTimeout(()=>debounceNext=false,180);
    if(!sjtPicks[s.id]) return; sjtTimes[sIndex]=Date.now()-screenStart; showStage('Slider'); setProgress(progressDone(),progressTotal()); goTop();
  };
}

/* ===== Slider ===== */
function renderSlider(){
  const val=Number($('#balance').value); if(!sliderTouched && val!==50) sliderTouched=true;
  sliderVal=val;
  const d=val-50; $('#balNote').textContent=(Math.abs(d)<5)?'Centered':(d<0?'Leans ship fast':'Leans polish details');
}
$('#balance').addEventListener('input',renderSlider);
$('#bBack').onclick=()=>{ showStage('SJT'); goTop(); };
$('#bNext').onclick=()=>{ if(debounceNext) return; debounceNext=true; setTimeout(()=>debounceNext=false,180); showStage('Plan'); setProgress(progressDone(),progressTotal()); goTop(); };

/* ===== Plan ===== */
function bindPlan(){
  $('#optTrial').onchange=()=> plan.opt=$('#optTrial').checked;
  $$('input[name="time"]').forEach(r=> r.onchange=()=> plan.time=r.value);
  $('#taskPick').onchange=()=> plan.task=$('#taskPick').value;
  $('#planText').addEventListener('input',()=>{ plan.text=$('#planText').value; });
  $('#pBack').onclick=()=>{ showStage('Slider'); goTop(); };
  $('#seeResults').onclick=()=> showResults();
}

/* ===== Navigation ===== */
function showStage(which){
  ['stageTriad','stageSJT','stageSlider','stagePlan','stageR'].forEach(id=>$('#'+id).classList.remove('active'));
  if(which==='Triad'){ $('#stageTriad').classList.add('active'); renderTriad(); }
  if(which==='SJT'){ $('#stageSJT').classList.add('active'); renderSJT(); }
  if(which==='Slider'){ $('#stageSlider').classList.add('active'); renderSlider(); }
  if(which==='Plan'){ $('#stagePlan').classList.add('active'); }
  if(which==='R'){ $('#stageR').classList.add('active'); }
}

/* ===== Scoring (short form) ===== */
/* Triad scoring simplified for short test:
   Most with pol +1 => +10 to trait, pol -1 => -10
   Least with pol +1 => -5 to trait, pol -1 => +5
   Sum on top of baseline 50, clamp to 0..100
*/
function scoreTriadsShort(){
  const traitScore={IN:50,OW:50,RE:50,DE:50}; let risk=0;
  TRIADS.forEach((t,idx)=>{
    const sel=triadPicks[t.id]||{}; if(!(sel.most&&sel.least)) return;
    const mo=t.items.find(i=>i.id===sel.most); const le=t.items.find(i=>i.id===sel.least);
    if(mo){
      if(mo.trait) traitScore[mo.trait]+= (mo.pol||1)>0 ? 10 : -10;
      if(typeof mo.risk==='number') risk+=mo.risk;
    }
    if(le){
      if(le.trait) traitScore[le.trait]+= (le.pol||1)>0 ? -5 : +5;
      if(typeof le.risk==='number') risk-=le.risk;
    }
    // record timing metrics
    const mp=t.items.findIndex(i=>i.id===sel.most), lp=t.items.findIndex(i=>i.id===sel.least);
    mostPositions[idx]=mp; leastPositions[idx]=lp;
  });
  for(const k in traitScore){ traitScore[k]=clamp(Math.round(traitScore[k]),0,100); }
  const riskPct=clamp(Math.round(50 + risk*10),0,100);
  return {trait:traitScore, riskPct};
}
function scoreSJT(){
  const s=SJT[0]; const pick=s.options.find(o=>o.k===sjtPicks[s.id]);
  const raw=pick?(pick.s||0):0, max=Math.max(...s.options.map(o=>o.s||0));
  const pct=max?Math.round((raw/max)*100):0;
  const triskPct=clamp(Math.round(50 + (pick?.trisk||0)*15),0,100);
  return {pct,triskPct,raw,max};
}
function sliderAdj(){ const v=sliderVal; const a={IN:0,OW:0,RE:0,DE:0}; if(v<45)a.DE=Math.round(50-v); if(v>55)a.RE=Math.round(v-50); return a; }
function planScore(tx){
  const t=(tx||'').toLowerCase(); if(!t.trim()) return 0;
  let pts=0; ['step','owner','assign','time','minute','metric','check','rollback','triage','status']
    .forEach(w=>{if(t.includes(w))pts++});
  if(/\d+ ?min/.test(t))pts++;
  if(/->|•|- /.test(t))pts++;
  if(t.length>=100)pts+=2;
  if((/(assign|post|run|check|note)/.test(t)) && /(owner|who)/.test(t)) pts++;
  return clamp(pts,0,12);
}

/* ===== Low effort checks ===== */
function lowEffortCheck(){
  const flags=[];
  const totalSecs = timeUsedSecs();
  if(totalSecs < 45) flags.push('very fast overall');
  const quickPairs = pairGaps.filter(ms=>ms && ms<350).length;
  if(pairGaps.length && quickPairs/pairGaps.length >= 0.6) flags.push('pair picks too quick');
  const uniqMost = new Set(mostPositions.filter(v=>v!==undefined)).size;
  const uniqLeast = new Set(leastPositions.filter(v=>v!==undefined)).size;
  if(uniqMost<=1 || uniqLeast<=1) flags.push('low choice diversity');
  if(!sliderTouched) flags.push('slider untouched');
  if(sjtPickLetters.length===SJT.length && new Set(sjtPickLetters).size===1) flags.push('same letter on scenarios');
  if(totalSecs > TOTAL_SECONDS){ flags.push('timer expired'); timerExpired=true; }
  if(recentAttempts(24) >= 3) flags.push('multiple retakes');
  const lowEffort = flags.length>=2;
  return {lowEffort, flags, totalSecs};
}

/* ===== Results ===== */
function renderBars(trait){
  const box=$('#scoreBox'); box.innerHTML='';
  TRAITS.forEach(t=>{
    const v=trait[t.k]||0;
    const wrap=document.createElement('div');
    wrap.innerHTML=`<div style="display:flex;justify-content:space-between;align-items:center;margin-top:6px"><strong>${t.name}</strong><span class="muted">${v}/100</span></div><div class="scorebar"><span style="width:${v}%"></span></div>`;
    box.appendChild(wrap);
  });
}
function drawRadar(trait){
  const cvs=$('#radar'); const dpr=window.devicePixelRatio||1;
  const cssW=cvs.clientWidth||560, cssH=Math.round(cssW*0.64);
  cvs.width=Math.floor(cssW*dpr); cvs.height=Math.floor(cssH*dpr);
  cvs.style.height=cssH+'px';
  const ctx=cvs.getContext('2d'); ctx.setTransform(dpr,0,0,dpr,0,0);
  const w=cssW,h=cssH,cx=w/2,cy=h/2,r=Math.min(w,h)*0.38;
  ctx.clearRect(0,0,w,h);
  ctx.strokeStyle='#e5e7eb'; ctx.lineWidth=1;
  for(let ring=1; ring<=4; ring++){
    ctx.beginPath();
    for(let i=0;i<TRAITS.length;i++){
      const ang=(Math.PI*2*i/TRAITS.length)-Math.PI/2, rr=r*ring/4;
      const x=cx+rr*Math.cos(ang), y=cy+rr*Math.sin(ang);
      if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    }
    ctx.closePath(); ctx.stroke();
  }
  ctx.fillStyle='#334155'; ctx.font='12px Inter, ui-sans-serif';
  for(let i=0;i<TRAITS.length;i++){
    const ang=(Math.PI*2*i/TRAITS.length)-Math.PI/2;
    ctx.beginPath(); ctx.moveTo(cx,cy); ctx.lineTo(cx+r*Math.cos(ang), cy+r*Math.sin(ang)); ctx.strokeStyle='#cbd5e1'; ctx.stroke();
    const lx=cx+(r+18)*Math.cos(ang), ly=cy+(r+18)*Math.sin(ang);
    ctx.textAlign=Math.abs(Math.cos(ang))<0.3?'center':(Math.cos(ang)>0?'left':'right');
    ctx.fillText(TRAITS[i].name,lx,ly);
  }
  ctx.beginPath();
  for(let i=0;i<TRAITS.length;i++){
    const v=(trait[TRAITS[i].k]||0)/100;
    const ang=(Math.PI*2*i/TRAITS.length)-Math.PI/2;
    const x=cx+(r*v)*Math.cos(ang), y=cy+(r*v)*Math.sin(ang);
    if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
  }
  ctx.closePath();
  const grad=ctx.createLinearGradient(0,0,w,0); grad.addColorStop(0,'#93c5fd66'); grad.addColorStop(1,'#2563eb66');
  ctx.fillStyle=grad; ctx.fill(); ctx.strokeStyle='#2563eb'; ctx.lineWidth=2; ctx.stroke();
}
window.addEventListener('resize',()=>{ if($('#stageR').classList.contains('active')){ drawRadar(latestResult?.trait||{IN:0,OW:0,RE:0,DE:0}); } });

let latestResult=null;
function computeResults(){
  const tri=scoreTriadsShort(), sjt=scoreSJT(), adj=sliderAdj(), planPts=planScore(plan.text);
  const trait={}; for(const t of TRAITS){ trait[t.k]=clamp(Math.round(tri.trait[t.k] + (adj[t.k]||0)*0.2),0,100); }
  let base=0; const W={IN:.28,OW:.22,RE:.25,DE:.25}; for(const k in W){ base+=(trait[k]||0)*W[k]; } base=Math.round(base);
  let fit=Math.round(0.8*base + 0.2*sjt.pct + planPts);
  const risk=clamp(Math.round(0.7*tri.riskPct + 0.3*sjt.triskPct),0,100);
  const eff=lowEffortCheck(); if(eff.lowEffort){ fit = clamp(fit-18, 0, 100); }
  return {trait,sjt,fit,risk,planPts,eff};
}
function engagementStyle(){
  const secs=Math.round((Date.now()-START)/1000);
  if(secs<75) return 'Fast decider, quick taps and short path to result.';
  if(secs<210) return 'Balanced, steady pace with focused selections.';
  return 'Deliberative, careful reading and considered picks.';
}
function roleSuggest(trait){
  const top=Object.entries(trait).sort((a,b)=>b[1]-a[1])[0]?.[0]||'IN';
  if(top==='IN') return 'Execution lead, prototype sprints, Discord ops, web builds.';
  if(top==='OW') return 'Project lead, scope and follow through, cross team glue.';
  if(top==='RE') return 'QA, docs, analytics checks, reliability owner.';
  return 'Decision facilitator, growth experiments, A B tests, KPI guard.';
}
function roomSuggest(trait){
  const top=Object.entries(trait).sort((a,b)=>b[1]-a[1])[0]?.[0]||'IN';
  if(top==='IN') return 'Tech, Gaming, Writers';
  if(top==='OW') return 'General, Lounge';
  if(top==='RE') return 'General, Regional';
  return 'Tech, General';
}
function serviceSuggest(trait){
  const top=Object.entries(trait).sort((a,b)=>b[1]-a[1])[0]?.[0]||'IN';
  if(top==='IN') return 'Web development';
  if(top==='OW') return 'SEO, Content';
  if(top==='RE') return 'SEO, Content';
  return 'SEO, Web development';
}

function showResults(){
  const R=computeResults(); latestResult=R;
  const manyRecent = recentAttempts(24) >= 3;

  const conf=$('#confBadge'); conf.style.display='inline-block'; conf.classList.remove('ok','warn','bad');
  if(R.eff.lowEffort){ conf.classList.add('bad'); conf.textContent='Confidence, low'+(manyRecent?', retake noted':''); }
  else { conf.classList.add('ok'); conf.textContent='Confidence, normal'+(manyRecent?', retake noted':''); }

  const secs=R.eff.totalSecs|timeUsedSecs(); const left=Math.max(0, TOTAL_SECONDS - secs);
  const tBadge=$('#timeBadge'); tBadge.style.display='inline-block'; tBadge.classList.remove('ok','warn','bad');
  tBadge.textContent = `Time, ${Math.floor(secs/60)}:${String(secs%60).padStart(2,'0')} used`;
  if(secs > TOTAL_SECONDS){ tBadge.classList.add('bad'); tBadge.textContent+=', over time'; }
  else if(left<=60){ tBadge.classList.add('warn'); }

  let tier = 'Member fit, start with one clear contribution path.';
  if(R.fit>=80) tier='Strong contributor, invite to a small decision area.';
  else if(R.fit>=60) tier='Good contributor, give a clear task and a level up path.';
  if(R.eff.lowEffort) tier = 'Low confidence result, consider retaking with care.';
  $('#fitTier').textContent = tier;

  $('#fitScore').textContent=String(R.fit);
  renderBars(R.trait); drawRadar(R.trait);

  const b=$('#collabBadge'); b.classList.remove('ok','warn','bad');
  const riskAdj = R.eff.lowEffort ? Math.max(R.risk, 55) : R.risk;
  if(riskAdj<=35){ b.classList.add('ok'); b.textContent='Collaboration health, stable'; }
  else if(riskAdj<=65){ b.classList.add('warn'); b.textContent='Collaboration health, watch'; }
  else { b.classList.add('bad'); b.textContent='Collaboration health, caution'; }

  const topTwo=Object.entries(R.trait).sort((a,b)=>b[1]-a[1]).slice(0,2)
    .map(([k,v])=>TRAITS.find(t=>t.k===k).name+' ('+v+')').join(', ');
  $('#topTwo').textContent=topTwo;
  $('#roles').textContent=roleSuggest(R.trait);
  const pick=plan.task||'(no task picked)'; const planTxt=(plan.text||'').trim()||'No plan provided.';
  $('#firstTask').textContent=pick+'. '+planTxt;
  $('#engStyle').textContent=engagementStyle();

  const rooms=roomSuggest(R.trait)+'.', services=serviceSuggest(R.trait)+'.';
  $('#summary').textContent=[
    'CMX Contributor Fit, results',
    'Traits, '+TRAITS.map(t=>`${t.name} ${R.trait[t.k]}`).join(' | '),
    `SJT, ${R.sjt.raw}/${R.sjt.max} (${R.sjt.pct} percent)`,
    `Contributor Fit, ${R.fit}/100`,
    `Collaboration health, ${riskAdj<=35?'stable':riskAdj<=65?'watch':'caution'}`,
    `Confidence, ${(R.eff.lowEffort?'low':'normal')}${manyRecent?', retake noted':''}`,
    `Time used, ${Math.floor(secs/60)}:${String(secs%60).padStart(2,'0')} of 5:00`+(secs>TOTAL_SECONDS?', over time':''),
    'Engagement, '+engagementStyle(),
    'Recommended rooms, '+rooms,
    'Relevant services, '+services,
    'Plan score, '+R.planPts+'/12'
  ].join('\n');

  showStage('R'); goTop();
}

/* ===== Copy, Print, Mobile PNG ===== */
$('#copyBtn').onclick=()=>navigator.clipboard.writeText($('#summary').textContent).then(()=>alert('Summary copied'));
$('#printBtn').onclick=()=>window.print();
$('#againBtn').onclick=()=>location.reload();
$('#pngBtn').onclick=()=>{
  const title='CMX Contributor Fit, results';
  const fit=$('#fitScore').textContent, collab=$('#collabBadge').textContent, conf=$('#confBadge').textContent, timeTxt=$('#timeBadge').textContent;
  const strengths=$('#topTwo').textContent, roles=$('#roles').textContent, firstTask=$('#firstTask').textContent, eng=$('#engStyle').textContent;
  const bars=Array.from($('#scoreBox').querySelectorAll('.scorebar > span')).map(s=>parseInt(s.style.width));
  const radar=$('#radar');

  const W=1200, H=820, P=32;
  const c=document.createElement('canvas'); c.width=W; c.height=H; const ctx=c.getContext('2d');
  ctx.fillStyle='#fff'; ctx.fillRect(0,0,W,H);
  ctx.fillStyle='#0f172a'; ctx.font='700 28px Inter, Arial'; ctx.fillText(title,P,P+10);
  ctx.font='14px Inter, Arial'; ctx.fillStyle='#0f172a'; ctx.fillText('Contributor Fit, '+fit+'/100',P,P+48);
  ctx.fillStyle='#334155'; ctx.fillText(collab,P,P+72); ctx.fillText(conf,P+320,P+72); ctx.fillText(timeTxt,P+520,P+72);
  const labels=['Initiative','Ownership','Reliability','Decision style']; const bx=P, by=P+110, bw=420, bh=14, gap=24;
  for(let i=0;i<labels.length;i++){ ctx.fillStyle='#0f172a'; ctx.fillText(labels[i],bx,by+i*(bh+gap)-6);
    ctx.strokeStyle='#e5e7eb'; ctx.strokeRect(bx,by+i*(bh+gap),bw,bh);
    const w=Math.max(0,Math.min(bw,Math.round((bars[i]||0)/100*bw)));
    const grad=ctx.createLinearGradient(bx,0,bx+bw,0); grad.addColorStop(0,'#93c5fd'); grad.addColorStop(1,'#2563eb');
    ctx.fillStyle=grad; ctx.fillRect(bx,by+i*(bh+gap),w,bh);
  }
  ctx.drawImage(radar, W-560-P, P+20, 560, 360);

  function wrap(text,x,y,maxW,lh){ text=(text||'').replace(/\s+/g,' ').trim(); const words=text.split(' '); let line='';
    for(let i=0;i<words.length;i++){ const test=line+words[i]+' '; if(ctx.measureText(test).width>maxW && i>0){ ctx.fillText(line,x,y); line=words[i]+' '; y+=lh; } else { line=test; } }
    if(line) ctx.fillText(line,x,y); return y; }

  ctx.fillStyle='#0f172a'; ctx.font='600 18px Inter, Arial'; ctx.fillText('Top strengths',P,H/2);
  ctx.font='14px Inter, Arial'; ctx.fillStyle='#334155'; let y=wrap(strengths,P,H/2+20,W-2*P,20);
  ctx.fillStyle='#0f172a'; ctx.font='600 18px Inter, Arial'; y+=16; ctx.fillText('Role suggestions',P,y); y+=20;
  ctx.font='14px Inter, Arial'; ctx.fillStyle='#334155'; y=wrap(roles,P,y,W-2*P,20);
  ctx.fillStyle='#0f172a'; ctx.font='600 18px Inter, Arial'; y+=16; ctx.fillText('Suggested first task',P,y); y+=20;
  ctx.font='14px Inter, Arial'; ctx.fillStyle='#334155'; y=wrap(firstTask,P,y,W-2*P,20);
  ctx.fillStyle='#0f172a'; ctx.font='600 18px Inter, Arial'; y+=16; ctx.fillText('Engagement style',P,y); y+=20;
  ctx.font='14px Inter, Arial'; ctx.fillStyle='#334155'; wrap(eng,P,y,W-2*P,20);

  const a=document.createElement('a'); a.href=c.toDataURL('image/png'); a.download='cmx-contributor-fit.png'; document.body.appendChild(a); a.click(); a.remove();
};

/* ===== Init ===== */
function init(){ renderTriad(); bindPlan(); setProgress(progressDone(),progressTotal()); }
init();
</script>
</body>
</html>