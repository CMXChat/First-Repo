<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CMX • OSINT Operations Console</title>

<!-- Leaflet + AntPath -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
<script src="https://unpkg.com/leaflet-ant-path@1.3.0/dist/leaflet-ant-path.min.js"></script>

<!-- Chart.js (optional mini charts) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<!-- EXIF -->
<script src="https://cdn.jsdelivr.net/npm/exif-js"></script>

<style>
  :root{
    --bg: #0a0f1a;
    --bg-grad-a:#0f2027; --bg-grad-b:#203a43; --bg-grad-c:#2c5364;
    --glass: rgba(255,255,255,0.06);
    --glass-2: rgba(255,255,255,0.12);
    --line: rgba(255,255,255,0.12);
    --text:#e8f3ff; --muted:#9bb3c7;
    --accent:#00e5ff; --accent2:#17e2e2;
    --ok:#1ee3a4; --warn:#ffd166; --danger:#ff5454;
  }
  :root.light{
    --bg:#f6fbff; --bg-grad-a:#eaf4ff; --bg-grad-b:#e9f6ff; --bg-grad-c:#e8faff;
    --glass: rgba(0,0,0,0.04); --glass-2: rgba(0,0,0,0.08);
    --line: rgba(0,0,0,0.12);
    --text:#0c1220; --muted:#5d6b7c;
    --accent:#006dff; --accent2:#0aa2ff;
    --ok:#0ea36a; --warn:#b78700; --danger:#d33d3d;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--text);
    background:linear-gradient(135deg,var(--bg-grad-a),var(--bg-grad-b),var(--bg-grad-c));
    font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
  }

  /* Topbar */
  .topbar{
    position:sticky; top:0; z-index:30;
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    padding:10px 14px; border-bottom:1px solid var(--line);
    background:linear-gradient(180deg,rgba(0,0,0,0.4),rgba(255,255,255,0.02));
    backdrop-filter: blur(8px);
  }
  .brand{display:flex;align-items:center;gap:10px;font-weight:800;color:var(--accent)}
  .dot{width:10px;height:10px;border-radius:999px;background:var(--ok);box-shadow:0 0 8px var(--ok)}
  .top-actions{display:flex;gap:8px;align-items:center}
  .ghost{all:unset;cursor:pointer;padding:8px 10px;border-radius:10px;border:1px solid var(--line);background:var(--glass);color:var(--text);font-size:13px}
  .chip{padding:6px 10px;border-radius:10px;border:1px solid var(--line);background:var(--glass);font-size:13px;color:var(--text)}

  /* Layout */
  .shell{display:grid;grid-template-columns:280px 1fr;min-height:calc(100vh - 58px)}
  .side{
    position:sticky;top:58px;height:calc(100vh - 58px);border-right:1px solid var(--line);
    background:linear-gradient(180deg,rgba(0,0,0,.35),rgba(255,255,255,.05));
    padding:14px; overflow:auto;
  }
  .nav{display:grid;gap:8px}
  .nav button{all:unset;cursor:pointer;padding:10px 12px;border-radius:10px;border:1px solid var(--line);background:var(--glass);color:var(--text);font-size:14px}
  .nav button.active{background:var(--glass-2);border-color:var(--accent)}
  .main{padding:14px;overflow:auto}

  /* Cards */
  .grid{display:grid;gap:12px;grid-template-columns:1fr}
  @media(min-width:1100px){.grid{grid-template-columns:1.2fr 1fr}}
  .card{border:1px solid var(--line);background:var(--glass);border-radius:14px;padding:14px}
  .card h3{margin:0 0 10px;color:var(--accent);letter-spacing:.2px}
  .sub{color:var(--muted);font-size:12px;margin-bottom:10px}
  .row{display:grid;grid-template-columns:1fr;gap:10px}
  @media(min-width:620px){.row{grid-template-columns:1fr auto}}
  input[type=text],input[type=email],input[type=file],textarea{
    width:100%;padding:12px;border-radius:12px;background:var(--glass);
    border:1px solid var(--line);color:var(--text);outline:none;font-size:15px
  }
  input::placeholder, textarea::placeholder{color:#8ca5bb}
  .btn{all:unset;cursor:pointer;padding:12px 16px;border-radius:12px;background:linear-gradient(180deg,rgba(0,255,255,.15),rgba(0,0,0,.12));border:1px solid rgba(0,255,255,.35);color:var(--accent);font-weight:700}
  .btn.mono{background:var(--glass);border-color:var(--line);color:var(--text)}
  .pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:var(--glass);font-size:12px}
  .pill.ok{color:var(--ok)} .pill.bad{color:var(--danger)} .pill.unk{color:var(--muted)}

  .links{display:grid;gap:8px;grid-template-columns:1fr 1fr}
  @media(max-width:680px){.links{grid-template-columns:1fr}}
  .links .group{border:1px solid var(--line);border-radius:12px;padding:10px}
  .links h4{margin:0 0 8px;color:var(--accent2)}
  .linklist a{display:inline-block;margin:4px 6px 0 0;text-decoration:none;padding:8px 10px;border-radius:10px;border:1px solid var(--line);color:var(--text);background:var(--glass);font-size:13px}

  /* Terminal */
  .terminal{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;background:#000;color:#9ee8ff;border-radius:12px;padding:10px;border:1px solid rgba(0,255,255,.25);min-height:180px;max-height:280px;overflow-y:auto;white-space:pre-wrap}
  .term-input{display:flex;gap:8px;margin-top:8px}
  .term-input input{flex:1;padding:10px 12px;border-radius:10px;border:1px solid var(--line);background:var(--glass);color:var(--text)}
  .foot{text-align:right;color:var(--muted);font-size:12px;margin-top:10px}

  /* Map */
  #map{height:380px;border-radius:12px;overflow:hidden;border:1px solid rgba(0,255,255,.25)}
  .leaflet-container{background:#08131c}

  /* Tables / key-values */
  table.meta{width:100%;border-collapse:collapse;font-size:13px}
  table.meta td,table.meta th{padding:6px 8px;border-bottom:1px dashed var(--line)}
  table.meta th{text-align:left;color:var(--muted)}
  .kv{border:1px dashed var(--line);border-radius:10px;padding:10px}

  /* Extractor chips */
  .chips{display:flex;flex-wrap:wrap;gap:8px}
  .chip-btn{display:inline-block;padding:6px 10px;border-radius:10px;border:1px solid var(--line);background:var(--glass);cursor:pointer;font-size:13px}

  /* Mobile sidebar toggle */
  .hamburger{display:none}
  @media(max-width:980px){
    .shell{grid-template-columns:1fr}
    .side{position:fixed;left:0;top:58px;width:86%;max-width:320px;transform:translateX(-110%);transition:transform .25s ease;z-index:40}
    .side.open{transform:translateX(0)}
    .hamburger{display:inline-flex}
  }
</style>
</head>
<body>
  <header class="topbar">
    <div class="brand"><button class="ghost hamburger" id="btnSide">☰</button><span class="dot"></span> CMX OSINT</div>
    <div class="top-actions">
      <span class="chip">Session: <b id="sid"></b></span>
      <button class="ghost" id="toggleTheme">Dark / Light</button>
    </div>
  </header>

  <div class="shell">
    <!-- Sidebar -->
    <aside class="side" id="sidebar">
      <div class="nav">
        <button class="active" onclick="go('emailCard')">Email</button>
        <button onclick="go('userCard')">Username</button>
        <button onclick="go('domainCard')">Domain</button>
        <button onclick="go('ipCard')">IP</button>
        <button onclick="go('textCard')">Text Extractor</button>
        <button onclick="go('fileCard')">Files</button>
        <button onclick="go('mapCard')">Map</button>
        <button onclick="go('terminalCard')">Terminal</button>
      </div>
    </aside>

    <!-- Main -->
    <main class="main">
      <div class="grid">

        <!-- EMAIL -->
        <div class="card" id="emailCard">
          <h3>Email Intelligence</h3>
          <div class="sub">Enter an email → provider guess, Gravatar probe, link packs (breaches, pastebins, social, keys).</div>
          <div class="row">
            <input type="email" id="email" placeholder="name@domain.com" />
            <button class="btn" id="analyzeBtn">Analyze</button>
          </div>
          <div id="emailMsg" class="sub" style="margin-top:8px"></div>

          <div class="row" style="margin-top:8px">
            <div class="kv">
              <div class="sub">Email</div><div id="outEmail" style="font-weight:700">—</div>
            </div>
            <div class="kv">
              <div class="sub">Domain</div><div id="outDomain" style="font-weight:700">—</div>
            </div>
          </div>
          <div class="row" style="margin-top:8px">
            <div class="kv">
              <div class="sub">Provider</div><div id="outProvider"><span class="pill unk">unknown</span></div>
            </div>
            <div class="kv">
              <div class="sub">MD5 (Gravatar)</div><div id="outMD5" style="font-family:monospace">—</div>
            </div>
          </div>

          <div style="display:flex;align-items:center;gap:10px;margin-top:10px">
            <div class="avatar" id="gravBox" style="width:88px;height:88px;border-radius:12px;border:1px solid var(--line);background:var(--glass-2);display:flex;align-items:center;justify-content:center;overflow:hidden"><span class="sub">No avatar</span></div>
            <div class="sub">If a public Gravatar exists, it will show here.</div>
          </div>

          <div class="links" id="emailLinks" style="margin-top:12px"></div>

          <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
            <button class="btn mono" id="copyMD5">Copy MD5</button>
            <a class="btn mono" id="mailto" href="#" target="_blank" rel="noopener">Mailto</a>
            <button class="btn mono" id="openEmailLinks">Open All Links</button>
          </div>
        </div>

        <!-- USERNAME -->
        <div class="card" id="userCard">
          <h3>Username Intelligence</h3>
          <div class="sub">Build reconnaissance links for a handle across platforms/search.</div>
          <div class="row">
            <input type="text" id="user" placeholder="username" />
            <button class="btn" id="userBtn">Build</button>
          </div>
          <div class="links" id="userLinks" style="margin-top:12px"></div>
          <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
            <button class="btn mono" id="openUserLinks">Open All Links</button>
          </div>
        </div>

        <!-- DOMAIN -->
        <div class="card" id="domainCard">
          <h3>Domain Intelligence</h3>
          <div class="sub">Live DNS (A/AAAA/MX/NS/TXT via dns.google) + link packs.</div>
          <div class="row">
            <input type="text" id="domain" placeholder="example.com" />
            <button class="btn" id="domainBtn">Resolve</button>
          </div>
          <div id="dnsMsg" class="sub"></div>
          <table class="meta" id="dnsTable" style="margin-top:8px"></table>
          <div class="links" id="domainLinks" style="margin-top:12px"></div>
          <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
            <button class="btn mono" id="openDomainLinks">Open All Links</button>
          </div>
        </div>

        <!-- IP -->
        <div class="card" id="ipCard">
          <h3>IP Intelligence</h3>
          <div class="sub">Geo/ASN via ipapi.co + OSINT link pack (Shodan, GreyNoise, AbuseIPDB, VT).</div>
          <div class="row">
            <input type="text" id="ip" placeholder="8.8.8.8" />
            <button class="btn" id="ipBtn">Lookup</button>
          </div>
          <div id="ipInfo" class="sub" style="margin-top:8px"></div>
          <div class="links" id="ipLinks" style="margin-top:12px"></div>
          <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
            <button class="btn mono" id="openIpLinks">Open All Links</button>
          </div>
        </div>

        <!-- TEXT EXTRACTOR -->
        <div class="card" id="textCard">
          <h3>Text Extractor</h3>
          <div class="sub">Paste any text → extract emails, IPs, URLs, domains (client-side), send to modules.</div>
          <textarea id="textBlob" rows="6" placeholder="Paste raw logs, emails, dumps, notes..."></textarea>
          <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
            <button class="btn" id="extractBtn">Extract</button>
            <button class="btn mono" id="clearBlob">Clear</button>
          </div>
          <div id="extractOut" style="margin-top:10px"></div>
        </div>

        <!-- FILES -->
        <div class="card" id="fileCard">
          <h3>File Intelligence</h3>
          <div class="sub">EXIF (images) • SHA-256 hasher (any file)</div>
          <div class="row">
            <div>
              <label class="sub">EXIF Viewer</label>
              <input type="file" id="exifFile" accept="image/*" />
              <div id="exifOut" style="margin-top:8px"></div>
            </div>
            <div>
              <label class="sub">SHA-256 Hasher</label>
              <input type="file" id="hashFile" />
              <div id="hashOut" style="margin-top:8px;font-family:monospace"></div>
            </div>
          </div>
        </div>

        <!-- MAP -->
        <div class="card" id="mapCard">
          <h3>Origin Map</h3>
          <div class="sub">Pulsing nodes + animated trace arcs</div>
          <div id="map"></div>
        </div>

        <!-- TERMINAL -->
        <div class="card" id="terminalCard">
          <h3>CMX Terminal</h3>
          <div class="sub">Try: <code>help</code> • <code>analyze alice@example.com</code> • <code>username somehandle</code> • <code>domain example.com</code> • <code>ip 1.1.1.1</code> • <code>dns example.com</code> • <code>extract</code> • <code>clear</code></div>
          <div class="terminal" id="terminal"></div>
          <div class="term-input">
            <input id="termIn" type="text" placeholder="> help" />
            <button class="btn" id="termBtn">Run</button>
          </div>
          <div class="foot">CMX • Swiss-Army OSINT Console</div>
        </div>

      </div>
    </main>
  </div>

<script>
/* ======= Shell / Theme / Sidebar ======= */
const root=document.documentElement;
const saved=localStorage.getItem('cmx-theme'); if(saved==='light') root.classList.add('light');
document.getElementById('toggleTheme').onclick=()=>{root.classList.toggle('light');localStorage.setItem('cmx-theme',root.classList.contains('light')?'light':'dark');};
document.getElementById('sid').textContent=Math.random().toString(36).slice(2,10).toUpperCase();
const sidebar=document.getElementById('sidebar'); document.getElementById('btnSide').onclick=()=>sidebar.classList.toggle('open');
function go(id){ document.getElementById(id).scrollIntoView({behavior:'smooth',block:'start'}); sidebar.classList.remove('open'); }

/* ======= Small helpers ======= */
function toast(el,msg,isErr){ el.innerHTML=`<span class="pill ${isErr?'bad':'ok'}">${msg}</span>`; setTimeout(()=>el.textContent='',3500); }
function sanitize(s){ return encodeURIComponent((s||'').trim()); }
function isValidEmail(e){ return /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/i.test(e); }
function providerOf(domain){ const d=(domain||'').toLowerCase();
  if(/gmail\.com$/.test(d)) return 'Gmail';
  if(/(outlook|hotmail|live)\.com$/.test(d)) return 'Outlook/Microsoft';
  if(/yahoo\.(com|co\.\w+)$/.test(d)) return 'Yahoo';
  if(/proton\.me$/.test(d)) return 'Proton';
  if(/icloud\.com$/.test(d)) return 'iCloud';
  if(/yandex\.(ru|com)$/.test(d)) return 'Yandex';
  return 'Unknown';
}

/* ======= MD5 (for Gravatar) ======= */
function md5cycle(x,k){let[a,b,c,d]=x;a=ff(a,b,c,d,k[0],7,-680876936);d=ff(d,a,b,c,k[1],12,-389564586);c=ff(c,d,a,b,k[2],17,606105819);b=ff(b,c,d,a,k[3],22,-1044525330);
a=ff(a,b,c,d,k[4],7,-176418897);d=ff(d,a,b,c,k[5],12,1200080426);c=ff(c,d,a,b,k[6],17,-1473231341);b=ff(b,c,d,a,k[7],22,-45705983);
a=ff(a,b,c,d,k[8],7,1770035416);d=ff(d,a,b,c,k[9],12,-1958414417);c=ff(c,d,a,b,k[10],17,-42063);b=ff(b,c,d,a,k[11],22,-1990404162);
a=ff(a,b,c,d,k[12],7,1804603682);d=ff(d,a,b,c,k[13],12,-40341101);c=ff(c,d,a,b,k[14],17,-1502002290);b=ff(b,c,d,a,k[15],22,1236535329);
a=gg(a,b,c,d,k[1],5,-165796510);d=gg(d,a,b,c,k[6],9,-1069501632);c=gg(c,d,a,b,k[11],14,643717713);b=gg(b,c,d,a,k[0],20,-373897302);
a=gg(a,b,c,d,k[5],5,-701558691);d=gg(d,a,b,c,k[10],9,38016083);c=gg(c,d,a,b,k[15],14,-660478335);b=gg(b,c,d,a,k[4],20,-405537848);
a=gg(a,b,c,d,k[9],5,568446438);d=gg(d,a,b,c,k[14],9,-1019803690);c=gg(c,d,a,b,k[3],14,-187363961);b=gg(b,c,d,a,k[8],20,1163531501);
a=gg(a,b,c,d,k[13],5,-1444681467);d=gg(d,a,b,c,k[2],9,-51403784);c=gg(c,d,a,b,k[7],14,1735328473);b=gg(b,c,d,a,k[12],20,-1926607734);
a=hh(a,b,c,d,k[5],4,-378558);d=hh(d,a,b,c,k[8],11,-2022574463);c=hh(c,d,a,b,k[11],16,1839030562);b=hh(b,c,d,a,k[14],23,-35309556);
a=hh(a,b,c,d,k[1],4,-1530992060);d=hh(d,a,b,c,k[4],11,1272893353);c=hh(c,d,a,b,k[7],16,-155497632);b=hh(b,c,d,a,k[10],23,-1094730640);
a=hh(a,b,c,d,k[13],4,681279174);d=hh(d,a,b,c,k[0],11,-358537222);c=hh(c,d,a,b,k[6],16,-722521979);b=hh(b,c,d,a,k[9],23,76029189);
a=ii(a,b,c,d,k[0],6,-198630844);d=ii(d,a,b,c,k[7],10,1126891415);c=ii(c,d,a,b,k[14],15,-1416354905);b=ii(b,c,d,a,k[5],21,-57434055);
a=ii(a,b,c,d,k[12],6,1700485571);d=ii(d,a,b,c,k[3],10,-1894986606);c=ii(c,d,a,b,k[10],15,-1051523);b=ii(b,c,d,a,k[1],21,-2054922799);
a=ii(a,b,c,d,k[8],6,1873313359);d=ii(d,a,b,c,k[15],10,-30611744);c=ii(c,d,a,b,k[6],15,-1560198380);b=ii(b,c,d,a,k[13],21,1309151649);
x[0]=add32(a,x[0]);x[1]=add32(b,x[1]);x[2]=add32(c,x[2]);x[3]=add32(d,x[3])}
function cmn(q,a,b,x,s,t){a=add32(add32(a,q),add32(x,t));return add32((a<<s)|(a>>>(32-s)),b)}
function ff(a,b,c,d,x,s,t){return cmn((b&c)|((~b)&d),a,b,x,s,t)}
function gg(a,b,c,d,x,s,t){return cmn((b&d)|(c&(~d)),a,b,x,s,t)}
function hh(a,b,c,d,x,s,t){return cmn(b^c^d,a,b,x,s,t)}
function ii(a,b,c,d,x,s,t){return cmn(c^(b|(~d)),a,b,x,s,t)}
function md51(s){const n=s.length,state=[1732584193,-271733879,-1732584194,271733878];let i;for(i=64;i<=n;i+=64){md5cycle(state,md5blk(s.substring(i-64,i)))}s=s.substring(i-64);const tail=Array(16).fill(0);for(i=0;i<s.length;i++)tail[i>>2]|=s.charCodeAt(i)<<((i%4)<<3);tail[i>>2]|=0x80<<((i%4)<<3);if(i>55){md5cycle(state,tail);for(i=0;i<16;i++)tail[i]=0}tail[14]=n*8;md5cycle(state,tail);return state}
function md5blk(s){const md5blks=[];for(let i=0;i<64;i+=4)md5blks[i>>2]=s.charCodeAt(i)+(s.charCodeAt(i+1)<<8)+(s.charCodeAt(i+2)<<16)+(s.charCodeAt(i+3)<<24);return md5blks}
function rhex(n){const s='0123456789abcdef';let j,out='';for(j=0;j<4;j++)out+=s[(n>>(j*8+4))&0x0F]+s[(n>>(j*8))&0x0F];return out}
function hex(x){for(let i=0;i<x.length;i++)x[i]=rhex(x[i]);return x.join('')}
function md5(s){return hex(md51(unescape(encodeURIComponent(s))).slice())}
function add32(a,b){return(a+b)&0xFFFFFFFF}

/* ======= EMAIL ======= */
let EMAIL_LINKS=[];
const emailEl=document.getElementById('email'), emailMsg=document.getElementById('emailMsg');
const outEmail=document.getElementById('outEmail'), outDomain=document.getElementById('outDomain'), outProvider=document.getElementById('outProvider'), outMD5=document.getElementById('outMD5');
const gravBox=document.getElementById('gravBox'), mailto=document.getElementById('mailto'), emailLinks=document.getElementById('emailLinks');

function buildEmailLinks(email,domain){
  EMAIL_LINKS=[];
  const E=sanitize(email), D=sanitize(domain), h=md5(email.toLowerCase());
  const groups=[
    ['Breach & Reputation',[
      ['Have I Been Pwned',`https://haveibeenpwned.com/account/${E}`],
      ['Epieos Email OSINT',`https://tools.epieos.com/email.php?email=${E}`],
      ['DeHashed (login)',`https://www.dehashed.com/search?query=${E}`],
      ['IntelX',`https://intelx.io/?s=${E}`],
      ['EmailRep',`https://emailrep.io/${E}`],
    ]],
    ['Search / Pastebins',[
      ['Google exact',`https://www.google.com/search?q="%22${E}%22"`],
      ['DuckDuckGo exact',`https://duckduckgo.com/?q="%22${E}%22"`],
      ['Bing exact',`https://www.bing.com/search?q="%22${E}%22"`],
      ['Google Pastebin',`https://www.google.com/search?q="%22${E}%22+site%3Apastebin.com`],
      ['Google Gists',`https://www.google.com/search?q="%22${E}%22+site%3Agist.github.com`],
      ['Skymem',`https://www.skymem.info/srch?q=${E}`],
    ]],
    ['Developer / Code',[
      ['GitHub search',`https://github.com/search?q=${E}`],
      ['GitLab search',`https://gitlab.com/search?search=${E}`],
      ['StackOverflow',`https://stackoverflow.com/search?q=${E}`],
    ]],
    ['People / Social',[
      ['Reddit',`https://www.reddit.com/search/?q=${E}`],
      ['X (Twitter)',`https://twitter.com/search?q=${E}&f=live`],
      ['LinkedIn (Google)',`https://www.google.com/search?q=site%3Alinkedin.com+%22${E}%22`],
    ]],
    ['PGP & Keys',[
      ['keys.openpgp.org',`https://keys.openpgp.org/search?q=${E}`],
      ['Ubuntu Keyserver',`https://keyserver.ubuntu.com/pks/lookup?search=${E}&fingerprint=on&op=index`],
    ]],
    ['Gravatar & Misc',[
      ['Gravatar image',`https://www.gravatar.com/avatar/${h}?s=400`],
      ['Gravatar JSON',`https://www.gravatar.com/${h}.json`],
      ['Hunter Verify (login)',`https://hunter.io/verify/${E}`],
    ]]
  ];
  emailLinks.innerHTML='';
  for(const [title,items] of groups){
    const wrap=document.createElement('div'); wrap.className='group';
    wrap.innerHTML=`<h4>${title}</h4><div class="linklist"></div>`;
    const list=wrap.querySelector('.linklist');
    items.forEach(([label,url])=>{const a=document.createElement('a');a.href=url;a.target='_blank';a.rel='noopener';a.textContent=label;list.appendChild(a);EMAIL_LINKS.push(url);});
    emailLinks.appendChild(wrap);
  }
}

async function analyzeEmail(input){
  const e=(input||emailEl.value||'').trim();
  if(!e){ toast(emailMsg,'Enter an email.'); return; }
  if(!isValidEmail(e)){ toast(emailMsg,'Invalid email.',true); return; }
  const [local,domain]=e.split('@'); const prov=providerOf(domain);
  outEmail.textContent=e; outDomain.textContent=domain;
  outProvider.innerHTML=prov==='Unknown'?'<span class="pill unk">unknown</span>':`<span class="pill ok">${prov}</span>`;
  mailto.href=`mailto:${encodeURIComponent(e)}`;
  const hash=md5(e.toLowerCase()); outMD5.textContent=hash;
  gravBox.innerHTML='<span class="sub">Checking Gravatar…</span>';
  const img=new Image(); img.onload=()=>{gravBox.innerHTML='';img.style.width='100%';img.style.height='100%';img.style.objectFit='cover';gravBox.appendChild(img)}; img.onerror=()=>{gravBox.innerHTML='<span class="sub">No avatar</span>'}; img.src=`https://www.gravatar.com/avatar/${hash}?d=404&s=160`;
  buildEmailLinks(e,domain);
  toast(emailMsg,'Email analysis complete.');
}
document.getElementById('analyzeBtn').onclick=()=>analyzeEmail();
emailEl.addEventListener('keydown',e=>{if(e.key==='Enter')analyzeEmail();});
document.getElementById('copyMD5').onclick=()=>{const v=outMD5.textContent.trim(); if(v&&v!=='—'){navigator.clipboard.writeText(v); toast(emailMsg,'MD5 copied.');} };
document.getElementById('openEmailLinks').onclick=()=>EMAIL_LINKS.forEach(u=>window.open(u,'_blank','noopener'));

/* ======= USERNAME ======= */
let USER_LINKS=[];
const userLinks=document.getElementById('userLinks');
function buildUserLinks(handle){
  USER_LINKS=[];
  const u=sanitize(handle);
  const groups=[
    ['Profiles',[
      ['GitHub',`https://github.com/${u}`],
      ['GitLab',`https://gitlab.com/${u}`],
      ['Reddit',`https://www.reddit.com/user/${u}`],
      ['X (Twitter)',`https://twitter.com/${u}`],
      ['Instagram',`https://www.instagram.com/${u}/`],
      ['TikTok',`https://www.tiktok.com/@${u}`],
      ['YouTube',`https://www.youtube.com/@${u}`],
      ['Keybase',`https://keybase.io/${u}`],
      ['Medium',`https://medium.com/@${u}`],
      ['HackerNews (search)',`https://hn.algolia.com/?q=${u}`],
    ]],
    ['Search',[
      ['Google',`https://www.google.com/search?q=${u}`],
      ['DuckDuckGo',`https://duckduckgo.com/?q=${u}`],
      ['Bing',`https://www.bing.com/search?q=${u}`],
      ['Google site:pastebin',`https://www.google.com/search?q="%22${u}%22"+site%3Apastebin.com`],
      ['Google site:gist',`https://www.google.com/search?q="%22${u}%22"+site%3Agist.github.com`],
    ]]
  ];
  userLinks.innerHTML='';
  for(const [title,items] of groups){
    const wrap=document.createElement('div'); wrap.className='group';
    wrap.innerHTML=`<h4>${title}</h4><div class="linklist"></div>`;
    const list=wrap.querySelector('.linklist');
    items.forEach(([label,url])=>{const a=document.createElement('a');a.href=url;a.target='_blank';a.rel='noopener';a.textContent=label;list.appendChild(a);USER_LINKS.push(url);});
    userLinks.appendChild(wrap);
  }
}
document.getElementById('userBtn').onclick=()=>{const v=document.getElementById('user').value.trim(); if(!v)return; buildUserLinks(v);};
document.getElementById('openUserLinks').onclick=()=>USER_LINKS.forEach(u=>window.open(u,'_blank','noopener'));

/* ======= DOMAIN (DNS over HTTPS) ======= */
let DOMAIN_LINKS=[];
async function doh(name,type){ const r=await fetch(`https://dns.google/resolve?name=${encodeURIComponent(name)}&type=${type}`,{cache:'no-store'}); if(!r.ok) throw 0; return r.json(); }
function rowify(arr){ return arr.map(x=>`<tr><th>${x[0]}</th><td>${x[1]}</td></tr>`).join(''); }
document.getElementById('domainBtn').onclick=async()=>{
  const d=document.getElementById('domain').value.trim(); const msg=document.getElementById('dnsMsg'); const tbl=document.getElementById('dnsTable'); const out=document.getElementById('domainLinks');
  if(!d){ toast(msg,'Enter a domain.'); return; }
  msg.textContent='Resolving…'; tbl.innerHTML=''; out.innerHTML=''; DOMAIN_LINKS=[];
  try{
    const [A,AAAA,MX,NS,TXT]=await Promise.all([doh(d,'A'),doh(d,'AAAA'),doh(d,'MX'),doh(d,'NS'),doh(d,'TXT')]);
    const lines=[];
    lines.push(['A', (A.Answer||[]).map(a=>a.data).join(', ')||'—']);
    lines.push(['AAAA',(AAAA.Answer||[]).map(a=>a.data).join(', ')||'—']);
    lines.push(['MX', (MX.Answer||[]).map(a=>a.data).join(' | ')||'—']);
    lines.push(['NS', (NS.Answer||[]).map(a=>a.data).join(', ')||'—']);
    lines.push(['TXT',(TXT.Answer||[]).map(a=>a.data.replaceAll('"','')).join('' | ')||'—']);
    tbl.innerHTML = rowify(lines);

    // Domain link packs
    const D = encodeURIComponent(d);
    const groups = [
      ['Surface', [
        ['crt.sh', `https://crt.sh/?q=${D}`],
        ['urlscan.io', `https://urlscan.io/domain/${D}`],
        ['VirusTotal', `https://www.virustotal.com/gui/domain/${D}`],
        ['SecurityTrails', `https://securitytrails.com/domain/${D}/dns`],
        ['BuiltWith', `https://builtwith.com/${D}`],
      ]],
      ['Infra', [
        ['Shodan', `https://www.shodan.io/search?query=${D}`],
        ['Censys', `https://search.censys.io/search?resource=hosts&q=${D}`],
        ['DNSDumpster', `https://dnsdumpster.com/`],
      ]]
    ];
    for (const [title, items] of groups) {
      const wrap = document.createElement('div'); wrap.className = 'group';
      wrap.innerHTML = `<h4>${title}</h4><div class="linklist"></div>`;
      const list = wrap.querySelector('.linklist');
      items.forEach(([label, url]) => {
        const a = document.createElement('a');
        a.href = url; a.target = '_blank'; a.rel = 'noopener'; a.textContent = label;
        list.appendChild(a);
        DOMAIN_LINKS.push(url);
      });
      out.appendChild(wrap);
    }
    msg.textContent = 'DNS resolved.';
  } catch (e) {
    toast(msg, 'DNS lookup blocked/unavailable.', true);
  }
};
document.getElementById('openDomainLinks').onclick = () => DOMAIN_LINKS.forEach(u => window.open(u, '_blank', 'noopener'));

/* ======= IP (ipapi.co) ======= */
let IP_LINKS = [];
document.getElementById('ipBtn').onclick = async () => {
  const ip = document.getElementById('ip').value.trim();
  const info = document.getElementById('ipInfo');
  const out = document.getElementById('ipLinks');
  if (!ip) { toast(info, 'Enter an IP.'); return; }
  info.textContent = 'Querying…'; out.innerHTML = ''; IP_LINKS = [];
  try {
    const r = await fetch(`https://ipapi.co/${ip}/json/`, { cache: 'no-store' }); if (!r.ok) throw 0;
    const data = await r.json();
    if (data && data.latitude != null) {
      info.innerHTML = `IP: <b>${ip}</b> • ${data.city || '—'}, ${data.region || ''} ${data.country_name || ''} • ASN: ${data.asn || '—'} • Org: ${data.org || '—'}`;
      if (typeof map !== 'undefined') {
        map.setView([data.latitude, data.longitude], 6);
        pulse(data.latitude, data.longitude, `${data.city || ''} ${data.country || ''}`.trim());
      }
    } else {
      info.innerHTML = 'Limited geo—use external tools below.';
    }
  } catch (e) {
    info.textContent = 'Client-side lookup blocked — use external tools.';
  }
  const s = encodeURIComponent(ip);
  const groups = [
    ['Reputation & Noise', [
      ['Shodan host', `https://www.shodan.io/host/${s}`],
      ['GreyNoise', `https://viz.greynoise.io/ip/${s}`],
      ['AbuseIPDB', `https://www.abuseipdb.com/check/${s}`],
      ['VirusTotal IP', `https://www.virustotal.com/gui/ip-address/${s}`],
    ]]
  ];
  for (const [title, items] of groups) {
    const wrap = document.createElement('div'); wrap.className = 'group';
    wrap.innerHTML = `<h4>${title}</h4><div class="linklist"></div>`;
    const list = wrap.querySelector('.linklist');
    items.forEach(([label, url]) => {
      const a = document.createElement('a');
      a.href = url; a.target = '_blank'; a.rel = 'noopener'; a.textContent = label;
      list.appendChild(a);
      IP_LINKS.push(url);
    });
    out.appendChild(wrap);
  }
};
document.getElementById('openIpLinks').onclick = () => IP_LINKS.forEach(u => window.open(u, '_blank', 'noopener'));

/* ======= TEXT EXTRACTOR ======= */
const blobEl = document.getElementById('textBlob');
const extractOut = document.getElementById('extractOut');
document.getElementById('extractBtn').onclick = () => {
  const t = blobEl.value || '';
  const emails = [...t.matchAll(/[^\s@]+@[^\s@]+\.[^\s@]{2,}/gi)].map(m => m[0]);
  const ips = [...t.matchAll(/\b(?:(?:25[0-5]|2[0-4]\d|[01]?\d?\d)(?:\.|$)){4}\b/g)].map(m => m[0]);
  const urls = [...t.matchAll(/\bhttps?:\/\/[^\s"'<>]+/gi)].map(m => m[0]);
  const domains = [...t.matchAll(/\b(?=.{3,255}\b)([a-z0-9-]+\.)+[a-z]{2,}\b/gi)].map(m => m[0]).filter(d => !/https?:\/\//i.test(d));
  const section = (title, arr, type) => {
    if (!arr.length) return '';
    const chips = arr.slice(0, 100).map(v => `<span class="chip-btn" data-type="${type}" data-val="${v}">${v}</span>`).join(' ');
    return `<div style="margin-top:8px"><div class="sub" style="margin-bottom:6px;color:var(--accent2)">${title} (${arr.length})</div><div class="chips">${chips}</div></div>`;
  };
  extractOut.innerHTML = [
    section('Emails', [...new Set(emails)], 'email'),
    section('IPs', [...new Set(ips)], 'ip'),
    section('URLs', [...new Set(urls)], 'url'),
    section('Domains', [...new Set(domains)], 'domain'),
  ].join('');
};
document.getElementById('clearBlob').onclick = () => { blobEl.value = ''; extractOut.innerHTML = ''; };
extractOut.addEventListener('click', (e) => {
  const el = e.target.closest('.chip-btn'); if (!el) return;
  const type = el.getAttribute('data-type'); const val = el.getAttribute('data-val');
  if (type === 'email') { document.getElementById('email').value = val; analyzeEmail(val); go('emailCard'); }
  if (type === 'ip') { document.getElementById('ip').value = val; document.getElementById('ipBtn').click(); go('ipCard'); }
  if (type === 'domain') { document.getElementById('domain').value = val; document.getElementById('domainBtn').click(); go('domainCard'); }
  if (type === 'url') window.open(val, '_blank', 'noopener');
});

/* ======= FILES: EXIF + SHA-256 ======= */
const exifFile = document.getElementById('exifFile');
const exifOut = document.getElementById('exifOut');
exifFile.addEventListener('change', async (e) => {
  exifOut.innerHTML = '';
  const file = e.target.files[0]; if (!file) return;
  const img = new Image();
  img.onload = function () {
    EXIF.getData(img, function () {
      const all = EXIF.getAllTags(this);
      if (!all || Object.keys(all).length === 0) { exifOut.innerHTML = '<div class="sub">No EXIF metadata found.</div>'; return; }
      let rows = '';
      for (const k of Object.keys(all)) {
        let v = all[k]; if (typeof v === 'object') v = JSON.stringify(v);
        rows += `<tr><th>${k}</th><td>${String(v).slice(0, 400)}</td></tr>`;
      }
      exifOut.innerHTML = `<table class="meta">${rows}</table>`;
    });
    URL.revokeObjectURL(img.src);
  };
  img.src = URL.createObjectURL(file);
});

const hashFile = document.getElementById('hashFile');
const hashOut = document.getElementById('hashOut');
hashFile.addEventListener('change', async (e) => {
  hashOut.textContent = 'Hashing…';
  const file = e.target.files[0]; if (!file) { hashOut.textContent = ''; return; }
  const buf = await file.arrayBuffer();
  const digest = await crypto.subtle.digest('SHA-256', buf);
  const hex = [...new Uint8Array(digest)].map(b => b.toString(16).padStart(2, '0')).join('');
  hashOut.textContent = hex;
});

/* ======= MAP + ARCS ======= */
const map = L.map('map', { zoomControl: false }).setView([20, 8], 2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '© OpenStreetMap', detectRetina: true }).addTo(map);

function pulse(lat, lng, label) {
  const core = L.circleMarker([lat, lng], { radius: 5, color: '#00ffff', fillColor: '#00ffff', fillOpacity: 1 }).addTo(map);
  core.bindTooltip(label || 'Node', { direction: 'top', offset: [0, -6] });
  const wave = L.circle([lat, lng], { radius: 15000, color: '#00ffff', weight: 1, fillColor: '#00ffff', fillOpacity: 0.12 }).addTo(map);
  let r = 15000, o = .18, fo = .08;
  const anim = setInterval(() => {
    r += 12000; o = Math.max(.08, o - .02); fo = Math.max(.02, fo - .01);
    wave.setRadius(r); wave.setStyle({ opacity: o, fillOpacity: fo });
    if (r > 180000) { map.removeLayer(wave); clearInterval(anim); }
  }, 110);
}
function arc(a, b, color = '#00ffff') {
  const midLat = (a.lat + b.lat) / 2 + 8;
  const midLng = (a.lng + b.lng) / 2;
  const line = new L.Polyline([[a.lat, a.lng], [midLat, midLng], [b.lat, b.lng]], { opacity: 0 });
  new L.polyline.antPath(line.getLatLngs(), {
    paused: false, reverse: false, delay: 250,
    dashArray: [14, 18], weight: 3, color, pulseColor: '#ffffff',
    hardwareAcceleration: true
  }).addTo(map);
}
const nodes = [
  { name: 'Brooklyn, US', lat: 40.6762, lng: -73.9521 },
  { name: 'Dubai, AE', lat: 25.2048, lng: 55.2708 },
  { name: 'Berlin, DE', lat: 52.52, lng: 13.4050 },
  { name: 'Auckland, NZ', lat: -36.8485, lng: 174.7633 },
  { name: 'Tel Aviv, IL', lat: 32.0853, lng: 34.7818 },
];
nodes.forEach((n, i) => setTimeout(() => pulse(n.lat, n.lng, n.name), 700 * i));
setTimeout(() => { arc(nodes[0], nodes[1]); setTimeout(() => arc(nodes[1], nodes[2], '#17e2e2'), 600); setTimeout(() => arc(nodes[2], nodes[3], '#00e5ff'), 1200); setTimeout(() => arc(nodes[3], nodes[4], '#7af7ff'), 1800); }, 1200);

/* ======= TERMINAL ======= */
const term = document.getElementById('terminal');
const termIn = document.getElementById('termIn');
const termBtn = document.getElementById('termBtn');
function tEcho(line=''){ term.textContent += (term.textContent ? '\n' : '') + line; term.scrollTop = term.scrollHeight; }
function tClear(){ term.textContent=''; }
function tHelp(){
  tEcho(`Commands:
  help                          show this help
  analyze <email>               run Email Intelligence
  username <handle>             build Username links
  domain <example.com>          resolve DNS + links
  ip <1.2.3.4>                  IP intel + links
  dns <example.com>             alias for 'domain'
  extract                       open Text Extractor section
  clear                         clear terminal`);
}
function run(cmdRaw){
  const raw = (cmdRaw || termIn.value || '').trim();
  if(!raw) return;
  tEcho('> ' + raw); termIn.value='';
  const [cmd, ...rest] = raw.split(/\s+/); const arg = rest.join(' ').trim();
  switch(cmd.toLowerCase()){
    case 'help': return tHelp();
    case 'clear': return tClear();
    case 'analyze': if(!arg) return tEcho('Usage: analyze <email>'); analyzeEmail(arg); return go('emailCard');
    case 'username': if(!arg) return tEcho('Usage: username <handle>'); document.getElementById('user').value = arg; buildUserLinks(arg); go('userCard'); return;
    case 'domain':
    case 'dns': if(!arg) return tEcho('Usage: domain <example.com>'); document.getElementById('domain').value = arg; document.getElementById('domainBtn').click(); go('domainCard'); return;
    case 'ip': if(!arg) return tEcho('Usage: ip <1.2.3.4>'); document.getElementById('ip').value = arg; document.getElementById('ipBtn').click(); go('ipCard'); return;
    case 'extract': go('textCard'); return;
    default: return tEcho("Unknown command. Type 'help'.");
  }
}
termBtn.addEventListener('click',()=>run());
termIn.addEventListener('keydown',e=>{ if(e.key==='Enter') run(); });
tEcho('[CMX] OSINT Console ready. Type "help".');

/* ======= BOOT ======= */
document.getElementById('analyzeBtn').focus();
</script>
</body>
</html>
```0