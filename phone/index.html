<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>CMX • Phone OSINT Console</title>
<meta name="color-scheme" content="dark">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin></script>
<!-- libphonenumber-js (ESM-friendly via Skypack) -->
<script type="module">
  import { parsePhoneNumberFromString } from "https://cdn.skypack.dev/libphonenumber-js@1.10.44";
  window._parsePN = parsePhoneNumberFromString;
</script>
<!-- Tesseract.js (for optional OCR) -->
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@v4/dist/tesseract.min.js"></script>

<style>
:root{
  --bg:#000; --panel:#0b0c0e; --panel-2:#111317; --panel-3:#0a0c10;
  --ink:#e7e9ea; --muted:#8b98a5; --line:#2f3336;
  --accent:#1d9bf0; --accent2:#82c8ff; --ok:#19c37d; --bad:#ff5a5f; --warn:#f6c76f; --vio:#b072ff;
  --r:16px; --pad:clamp(12px,2.8vw,22px);
  --fs-xl:clamp(22px,5.6vw,42px); --fs-lg:clamp(17px,3.2vw,22px);
  --fs:clamp(14px,3vw,16px); --fs-sm:clamp(12px,2.5vw,13.5px);
  --maxw:1200px;
}
*{box-sizing:border-box} html,body{height:100%} html{overscroll-behavior:contain}
body{
  margin:0;background:
    radial-gradient(1200px 600px at 20% -10%,rgba(29,155,240,.08),transparent),
    radial-gradient(1200px 600px at 120% 100%,rgba(130,200,255,.06),transparent),
    var(--bg);
  color:var(--ink);
  font:400 var(--fs)/1.6 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  -webkit-text-size-adjust:100%;
}
a{color:inherit;text-decoration:none}
kbd{border:1px solid var(--line);border-bottom-color:#1a1d22;background:#0d0f12;border-radius:6px;padding:2px 5px;font-size:11px}
hr{border:none;border-top:1px solid var(--line);margin:14px 0}
.small{font-size:var(--fs-sm);color:var(--muted)}
.hide{display:none}

/* Topbar */
.topbar{
  position:sticky;top:0;z-index:50;
  display:flex;align-items:center;justify-content:space-between;gap:10px;
  padding:var(--pad);
  background:rgba(0,0,0,.72);backdrop-filter:blur(8px);
  border-bottom:1px solid var(--line)
}
.brand{display:flex;align-items:center;gap:10px;font-weight:900;letter-spacing:.2px;min-width:0}
.logo{flex:0 0 30px;height:30px;border:1px solid var(--line);border-radius:10px;display:grid;place-items:center;background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.02))}
.logo svg{width:18px;height:18px;fill:var(--accent)}
.title{font-size:var(--fs-lg);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.chip{padding:7px 10px;border:1px solid var(--line);border-radius:999px;background:var(--panel);color:var(--muted);font-size:var(--fs-sm);white-space:nowrap}

/* Layout */
.container{max-width:var(--maxw);margin:0 auto;padding:0 var(--pad) calc(var(--pad) + env(safe-area-inset-bottom,0px))}
.grid{display:grid;gap:clamp(12px,2vw,16px);grid-template-columns:minmax(280px,360px) 1fr}
@media(max-width:1100px){.grid{grid-template-columns:1fr}}

/* Cards */
.card{border:1px solid var(--line);background:var(--panel-2);border-radius:16px;padding:16px}
.card h2{margin:.2rem 0 .6rem;font-size:var(--fs-lg)}
label{display:block;margin:10px 0 6px;font-weight:800}
input,textarea,select{
  width:100%;padding:12px 14px;border-radius:14px;background:var(--panel);
  border:1px solid var(--line);color:var(--ink);outline:none;font-size:var(--fs)
}
textarea{resize:vertical;min-height:96px}
.row{display:flex;gap:10px;flex-wrap:wrap}
.row>*{flex:1 1 160px}
.btn{
  all:unset;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;
  padding:12px 16px;border-radius:999px;font-weight:900;letter-spacing:.2px;
  border:1px solid var(--accent);
  background:linear-gradient(180deg,rgba(29,155,240,.18),rgba(29,155,240,.06));
}
.btn:active{transform:translateY(1px)}
.btn.ghost{background:transparent;border-color:var(--line)}
.btn.ok{border-color:var(--ok);background:linear-gradient(180deg,rgba(25,195,125,.18),rgba(25,195,125,.06))}
.btn.warn{border-color:var(--warn);background:linear-gradient(180deg,rgba(246,199,111,.18),rgba(246,199,111,.06))}
.btn.danger{border-color:var(--bad);background:linear-gradient(180deg,rgba(255,90,95,.18),rgba(255,90,95,.06))}
.pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:#0e1013;font-size:12px}
.pill.ok{color:var(--ok)} .pill.bad{color:var(--bad)} .pill.warn{color:var(--warn)} .pill.muted{color:var(--muted)}

/* Links grid */
.links{display:grid;gap:8px;grid-template-columns:1fr 1fr}
@media(max-width:720px){.links{grid-template-columns:1fr}}
.link-group{border:1px solid var(--line);border-radius:12px;background:var(--panel);padding:10px}
.link-group h4{margin:0 0 6px;color:#9fd1ff;font-size:14px}
.linklist a{display:inline-block;margin:4px 6px 0 0;padding:8px 10px;border-radius:999px;border:1px solid var(--line);text-decoration:none;color:var(--ink)}

/* Map */
#map{height:280px;border:1px solid var(--line);border-radius:12px;overflow:hidden}

/* Extractor chips */
.chips{display:flex;flex-wrap:wrap;gap:8px}
.chip-btn{padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:var(--panel);cursor:pointer;font-size:13px}

/* Toast */
.toast{
  position:fixed;left:50%;transform:translateX(-50%);bottom:16px;background:#0b0d12;border:1px solid var(--line);border-radius:12px;
  padding:8px 12px;font-size:12.5px;color:#cfe9ff;display:none;z-index:90
}
.toast.show{display:block;animation:fade 2.2s ease both}
@keyframes fade{0%{opacity:0;transform:translate(-50%,6px)}10%{opacity:1;transform:translate(-50%,0)}90%{opacity:1}100%{opacity:0;transform:translate(-50%,-6px)}}

footer{ text-align:center;color:var(--muted);font-size:var(--fs-sm);padding:12px }
</style>
</head>
<body>
<header class="topbar">
  <div class="brand">
    <div class="logo" aria-hidden="true">
      <svg viewBox="0 0 24 24"><path d="M17.5 3L12.9 9.1 20 21h-3.5l-4.7-7.6L7 21H4l5.7-8.6L4.2 3H7.7l4 6.6L16 3h1.5z"/></svg>
    </div>
    <div class="title">CMX • Phone OSINT Console</div>
  </div>
  <span class="chip">Session <b id="sid"></b></span>
</header>

<main class="container">
  <section class="card" style="margin:12px 0">
    <h2>Analyze a number</h2>
    <div class="row">
      <div>
        <label for="region">Default region (parsing fallback)</label>
        <select id="region">
          <option value="US">US</option><option value="GB">GB</option><option value="AU">AU</option>
          <option value="CA">CA</option><option value="IN">IN</option><option value="DE">DE</option>
          <option value="FR">FR</option><option value="ES">ES</option><option value="IT">IT</option>
          <option value="MX">MX</option><option value="BR">BR</option><option value="ZA">ZA</option>
          <option value="JP">JP</option><option value="CN">CN</option>
        </select>
      </div>
      <div>
        <label for="num">Phone number</label>
        <input id="num" placeholder="+1 555 123 4567">
      </div>
    </div>
    <div class="row" style="margin-top:8px">
      <button class="btn" id="analyze">Analyze</button>
      <button class="btn ghost" id="copyE164">Copy E.164</button>
      <button class="btn ghost" id="openAll">Open all pivots</button>
      <button class="btn warn" id="reset">Reset</button>
    </div>
    <div id="msg" class="small" style="margin-top:8px"></div>
  </section>

  <section class="grid">
    <!-- LEFT: results -->
    <aside class="card">
      <h2>Result</h2>
      <div class="row">
        <div><div class="small">E.164</div><div id="outE164" style="font-weight:900">—</div></div>
        <div><div class="small">International</div><div id="outIntl" style="font-weight:900">—</div></div>
      </div>
      <div class="row" style="margin-top:8px">
        <div><div class="small">National</div><div id="outNat" style="font-weight:900">—</div></div>
        <div><div class="small">Type</div><div id="outType" style="font-weight:900">—</div></div>
      </div>
      <div class="row" style="margin-top:8px">
        <div><div class="small">Country</div><div id="outCountry" style="font-weight:900">—</div></div>
        <div><div class="small">Local time</div><div id="outTime" style="font-weight:900">—</div></div>
      </div>
      <div class="row" style="margin-top:10px">
        <div id="badges" class="chips"></div>
      </div>

      <hr>
      <h2>Pivot links</h2>
      <div class="links" id="pivotLinks"></div>

      <hr>
      <h2>Map</h2>
      <div id="map"></div>
      <div class="small" style="margin-top:6px">Approximate country centroid only. No precise geolocation.</div>
    </aside>

    <!-- RIGHT: extractor / OCR -->
    <section class="card">
      <h2>Extract from text / image</h2>
      <div class="row">
        <textarea id="blob" placeholder="Paste logs, chat transcripts, notes… Numbers will be extracted client-side."></textarea>
      </div>
      <div class="row" style="margin-top:8px">
        <button class="btn" id="extract">Extract</button>
        <button class="btn ghost" id="clearBlob">Clear</button>
        <label class="btn ghost" for="imgFile">OCR image…</label>
        <input id="imgFile" type="file" accept="image/*" class="hide">
      </div>
      <div id="extractOut" style="margin-top:10px"></div>
      <div id="ocrMsg" class="small" style="margin-top:6px"></div>
    </section>
  </section>
</main>

<footer>© CMX</footer>
<div class="toast" id="toast">Saved</div>

<script>
/* ===== Utils ===== */
const $=s=>document.querySelector(s), $$=s=>[...document.querySelectorAll(s)];
$('#sid').textContent=Math.random().toString(36).slice(2,10).toUpperCase();
function toast(msg){ const t=$('#toast'); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1800); }
function setMsg(m,ok=true){ $('#msg').innerHTML = ok ? `<span class="pill ok">${m}</span>` : `<span class="pill danger">${m}</span>`; setTimeout(()=>$('#msg').textContent='',2800); }
const digitsOnly = s => (s||'').replace(/[^\d]/g,'');

/* Country centroids (very small set; extend as needed) */
const CC = {
  US:[39.8,-98.6], CA:[56.1,-106.3], GB:[54.8,-4.6], AU:[-25.3,133.8], IN:[21.1,79.0],
  DE:[51.1,10.4], FR:[46.2,2.2], ES:[40.4,-3.7], IT:[41.9,12.6], MX:[23.6,-102.5],
  BR:[-14.2,-51.9], ZA:[-30.6,22.9], JP:[36.2,138.3], CN:[35.9,104.2], RU:[61.5,105.3],
  NL:[52.1,5.3], SE:[60.1,18.6], NO:[60.5,8.5], DK:[56.2,9.5], FI:[64.2,26.3],
  PL:[52.1,19.4], RO:[45.9,24.9], TR:[38.9,35.2], AR:[-38.4,-63.6], CL:[-35.7,-71.5],
  CO:[4.6,-74.1], PE:[-9.2,-75.0], NZ:[-41.8,172.9], KR:[36.5,127.9], SG:[1.3,103.8],
  IE:[53.2,-8.2], PT:[39.4,-8.2]
};

/* Rough UTC offset guess by longitude (very approximate; DST ignored) */
function guessOffsetFromLon(lon){
  const off = Math.round(lon/15); // 15° ~ 1 hour
  const sign = off>=0?'+':'';
  return `UTC${sign}${off}`;
}

/* Map */
const map = L.map('map',{attributionControl:false, zoomControl:true}).setView([20,0],2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{subdomains:['a','b','c'],maxZoom:18}).addTo(map);
let marker = null;
function flyToCountry(cc){
  const pt = CC[cc] || [20,0];
  map.flyTo(pt, (cc==='US'||cc==='CA'||cc==='AU')?3:4, {duration:0.6});
  if(marker) map.removeLayer(marker);
  marker = L.circleMarker(pt,{radius:8,color:'#82c8ff',fillColor:'#1d9bf0',fillOpacity:.8,weight:2}).addTo(map);
}

/* libphonenumber glue (loaded as ESM in a separate <script type=module>) */
function parseNumber(raw, region){
  const p = window._parsePN ? window._parsePN(raw, region||'US') : null;
  return p && p.isPossible() ? p : (p && p.isValid() ? p : p);
}

/* Type pretty name */
const typeName = t => ({
  FIXED_LINE:'fixed line', MOBILE:'mobile', FIXED_LINE_OR_MOBILE:'fixed or mobile',
  TOLL_FREE:'toll-free', PREMIUM_RATE:'premium', SHARED_COST:'shared cost',
  VOIP:'voip', PERSONAL_NUMBER:'personal', PAGER:'pager', UAN:'uan',
  VOICEMAIL:'voicemail'
}[t] || (t||'unknown').toLowerCase());

/* NANP helpers */
const NANP_TF = new Set(['800','888','877','866','855','844','833','822']);
const NANP_PREMIUM = new Set(['900','976']); // heuristic
function nanpArea(num){ // returns area code if NANP
  const m = /^\+?1?[\s\-\.()]*([2-9]\d{2})/.exec(num.replace(/\D+/g,''));
  return m ? m[1] : null;
}
function npaNxx(num){ // returns {npa,nxx} for NANP
  const d = digitsOnly(num);
  if(d.length===11 && d[0]==='1') return { npa:d.slice(1,4), nxx:d.slice(4,7) };
  if(d.length===10) return { npa:d.slice(0,3), nxx:d.slice(3,6) };
  return { npa:null, nxx:null };
}

/* Build pivot links (now includes Carrier/HLR/CNAM group) */
function buildPivots(e164, intl, nat, country){
  const compact = e164.replace('+','');
  const variants = [e164, intl, nat, compact].filter(Boolean);
  const q = `"${variants.join('" OR "')}"`;
  const enc = s=>encodeURIComponent(s);

  const { npa, nxx } = npaNxx(e164);

  // Carrier / HLR / CNAM (links only; most require APIs server-side)
  const carrier = [];
  carrier.push(['FreeCarrierLookup (US/CA)','https://freecarrierlookup.com/']);
  if(npa && nxx){
    carrier.push([`LocalCallingGuide NPA-NXX (${npa}-${nxx})`,`https://www.localcallingguide.com/lca_prefix.php?npa=${npa}&nxx=${nxx}`]);
  }else{
    carrier.push(['LocalCallingGuide (enter NPA/NXX)','https://www.localcallingguide.com/lca_prefix.php']);
  }
  carrier.push(['HLR-Lookups (provider)','https://www.hlr-lookups.com/']);
  carrier.push(['Twilio Lookup — carrier/CNAM (API docs)','https://www.twilio.com/docs/lookup/api']);
  carrier.push(['numverify — carrier/line type (API docs)','https://numverify.com/documentation']);
  carrier.push(['Neutrino — phone-validate (API docs)','https://www.neutrinoapi.com/api/phone-validate/']);
  carrier.push(['OpenCNAM — caller name (API docs)','https://www.opencnam.com/docs']);
  carrier.push(['Numlookup.com (reverse page)','https://www.numlookup.com/']);

  const search = [
    ['Google',`https://www.google.com/search?q=${enc(q)}`],
    ['DuckDuckGo',`https://duckduckgo.com/?q=${enc(q)}`],
    ['Bing',`https://www.bing.com/search?q=${enc(q)}`],
    ['Scam search (Google)',`https://www.google.com/search?q=${enc(e164+' scam spam')}`]
  ];

  const social = [
    ['Twitter / X',`https://twitter.com/search?q=${enc(q)}&f=live`],
    ['Facebook',`https://www.facebook.com/search/top?q=${enc(e164)}`],
    ['GitHub',`https://github.com/search?q=${enc('"'+compact+'"')}`],
    ['Pastebin (via Google)',`https://www.google.com/search?q=${enc('site:pastebin.com "'+e164+'"')}`],
    ['Truecaller',`https://www.truecaller.com/search/${country==='US'||country==='CA'?'us':'global'}/${compact.replace(/^1/,'')}`]
  ];

  const messaging = [
    ['WhatsApp',`https://wa.me/${enc(compact)}`],
    ['Call (tel:)',`tel:${enc(e164)}`],
    ['SMS (sms:)',`sms:${enc(e164)}`]
  ];

  const groups = [
    ['Carrier / HLR / CNAM', carrier],
    ['Search', search],
    ['Social / Dumps', social],
    ['Messaging', messaging]
  ];

  // NANP extras group if applicable
  if(npa && nxx){
    groups.push(['NANP extras',[
      ['Area code (Wikipedia)', `https://en.wikipedia.org/wiki/Area_codes_${npa}`],
      ['NPA-NXX maps (npanxxsource)','https://www.npanxxsource.com/local-calling-areas-lookup.htm']
    ]]);
  }
  return groups;
}

/* Render helper for link groups */
function renderGroups(container, groups){
  container.innerHTML='';
  for(const [title, items] of groups){
    const box=document.createElement('div'); box.className='link-group';
    const h=document.createElement('h4'); h.textContent=title; box.appendChild(h);
    const list=document.createElement('div'); list.className='linklist';
    items.forEach(([label,url])=>{
      const a=document.createElement('a'); a.href=url; a.target='_blank'; a.rel='noopener'; a.textContent=label;
      list.appendChild(a);
    });
    box.appendChild(list); container.appendChild(box);
  }
}

/* Analyze */
let lastLinks = [];
function analyze(){
  const region = $('#region').value || 'US';
  const raw = $('#num').value.trim();

  if(!raw){ setMsg('Enter a number to analyze.', false); return; }

  const pn = parseNumber(raw, region);
  if(!pn || !pn.isValid()){
    $('#outE164').textContent='—';
    $('#outIntl').textContent='—';
    $('#outNat').textContent='—';
    $('#outType').textContent='invalid';
    $('#outCountry').textContent='—';
    $('#outTime').textContent='—';
    $('#badges').innerHTML = `<span class="pill bad">Invalid / not parseable</span>`;
    $('#pivotLinks').innerHTML='';
    setMsg('Not a valid phone number for the selected/default region.', false);
    return;
  }

  const e164 = pn.number;                       // +15551234567
  const intl = pn.formatInternational();        // +1 555-123-4567
  const nat  = pn.formatNational();             // (555) 123-4567
  const type = typeName(pn.getType()||'');
  const cc   = pn.country || '—';

  $('#outE164').textContent = e164;
  $('#outIntl').textContent = intl;
  $('#outNat').textContent  = nat;
  $('#outType').textContent = type;
  $('#outCountry').textContent = cc;

  // Badges
  const pills=[];
  if(type.includes('toll-free')) pills.push('<span class="pill ok">Toll-free</span>');
  if(type.includes('premium'))   pills.push('<span class="pill bad">Premium rate</span>');
  if(type.includes('voip'))      pills.push('<span class="pill warn">VOIP (heuristic)</span>');
  if(type.includes('mobile'))    pills.push('<span class="pill ok">Mobile</span>');
  if(type.includes('fixed'))     pills.push('<span class="pill">Fixed</span>');

  // NANP heuristics + NPA-NXX chip
  const area = nanpArea(e164);
  const { npa, nxx } = npaNxx(e164);
  if(pn.country==='US' || pn.country==='CA'){
    if(area && NANP_TF.has(area)) pills.push(`<span class="pill ok">NANP Toll-free ${area}</span>`);
    if(area && NANP_PREMIUM.has(area)) pills.push(`<span class="pill bad">NANP Premium ${area}</span>`);
    if(npa && nxx) pills.push(`<span class="pill muted">NPA-NXX ${npa}-${nxx}</span>`);
  }

  $('#badges').innerHTML = pills.join(' ') || '<span class="pill muted">No special flags</span>';

  // Time guess & map
  const pt = CC[cc] || [20,0];
  const offsetStr = guessOffsetFromLon(pt[1]);
  const nowUTC = new Date();
  const fakeLocal = new Date(nowUTC.getTime() + (parseInt(offsetStr.replace('UTC',''))||0)*3600000);
  $('#outTime').textContent = `${fakeLocal.toLocaleTimeString()} (${offsetStr})`;
  flyToCountry(cc);

  // Pivots (with new carrier/HLR/CNAM group)
  const groups = buildPivots(e164, intl, nat, cc);
  renderGroups($('#pivotLinks'), groups);
  lastLinks = groups.flatMap(([_,items])=>items.map(([__,url])=>url));

  localStorage.setItem('cmx_phone_last', JSON.stringify({region, raw}));
  setMsg('Analysis complete.');
}

/* Buttons */
$('#analyze').onclick = analyze;
$('#reset').onclick = ()=>{
  $('#num').value=''; $('#msg').textContent='';
  $('#outE164').textContent='—'; $('#outIntl').textContent='—'; $('#outNat').textContent='—';
  $('#outType').textContent='—'; $('#outCountry').textContent='—'; $('#outTime').textContent='—';
  $('#badges').innerHTML=''; $('#pivotLinks').innerHTML='';
};
$('#copyE164').onclick = ()=>{
  const v = $('#outE164').textContent.trim();
  if(v && v!=='—'){ navigator.clipboard.writeText(v); toast('E.164 copied'); }
};
$('#openAll').onclick = ()=>{
  if(!lastLinks.length){ toast('No links to open'); return; }
  if(confirm(`Open ${lastLinks.length} links in new tabs?`)){
    lastLinks.forEach(u=>window.open(u,'_blank','noopener'));
  }
};

/* Keyboard */
document.addEventListener('keydown',e=>{
  if(e.key==='Enter' && document.activeElement.id==='num'){ analyze(); }
});

/* Restore last */
(function restore(){
  try{
    const raw = localStorage.getItem('cmx_phone_last'); if(!raw) return;
    const v = JSON.parse(raw); if(v.region) $('#region').value = v.region;
    if(v.raw){ $('#num').value = v.raw; }
  }catch(_){}
})();

/* ===== Extractor ===== */
function extract(){
  const region = $('#region').value || 'US';
  const text = $('#blob').value || '';
  if(!text.trim()){ toast('Nothing to extract'); return; }
  const candidates = [...text.matchAll(/(?:(?:\+?\d{1,3}[ \-\.()]*)?(?:\d[ \-\.()]*){5,})(?=\D|$)/g)]
      .map(m=>m[0]).slice(0,500);
  const norm = new Set();
  candidates.forEach(c=>{
    const p = parseNumber(c, region);
    if(p && p.isValid()) norm.add(p.number);
  });
  const arr = [...norm];
  const out = $('#extractOut');
  if(!arr.length){ out.innerHTML='<div class="small">No valid numbers found.</div>'; return; }
  out.innerHTML = `<div class="small" style="margin-bottom:6px">Found ${arr.length} unique numbers</div>
  <div class="chips">${arr.map(n=>`<span class="chip-btn" data-val="${n}">${n}</span>`).join(' ')}</div>`;
}
$('#extract').onclick = extract;
$('#clearBlob').onclick = ()=>{ $('#blob').value=''; $('#extractOut').innerHTML=''; };
$('#extractOut').addEventListener('click',e=>{
  const el=e.target.closest('.chip-btn'); if(!el) return;
  $('#num').value = el.getAttribute('data-val'); analyze();
});

/* ===== OCR (optional) ===== */
$('#imgFile').addEventListener('change', async (e)=>{
  const f = e.target.files[0]; if(!f) return;
  $('#ocrMsg').textContent = 'OCR running (in-browser)…';
  try{
    const { data:{ text } } = await Tesseract.recognize(f, 'eng', { logger:m=>{} });
    $('#blob').value = ( $('#blob').value ? $('#blob').value + '\n' : '' ) + text;
    $('#ocrMsg').textContent = 'OCR done → use Extract.';
    toast('OCR complete');
  }catch(err){
    $('#ocrMsg').textContent = 'OCR failed.';
    toast('OCR failed');
  }finally{
    e.target.value='';
  }
});

/* Init map position */
flyToCountry('US');
</script>
</body>
</html>